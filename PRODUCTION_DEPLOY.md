# üöÄ –î–ï–ü–õ–û–ô –†–ï–ñ–ò–ú–ê –û–ë–°–õ–£–ñ–ò–í–ê–ù–ò–Ø –ù–ê –ü–†–û–î–ê–ö–®–ù

## üìã –ë—ã—Å—Ç—Ä–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### –®–∞–≥ 1: –õ–æ–∫–∞–ª—å–Ω–æ - –ö–æ–º–º–∏—Ç –∏ Push

```bash
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
git status

# 2. –î–æ–±–∞–≤—å—Ç–µ –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
git add .

# 3. –°–æ–∑–¥–∞–π—Ç–µ –∫–æ–º–º–∏—Ç
git commit -m "feat: –¥–æ–±–∞–≤–ª–µ–Ω —Ä–µ–∂–∏–º –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è —Å –¥–æ—Å—Ç—É–ø–æ–º –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

- –û–±–Ω–æ–≤–ª–µ–Ω middleware —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –ø–æ—Ä—è–¥–∫–æ–º (–ø–æ—Å–ª–µ AuthenticationMiddleware)
- –û–±–Ω–æ–≤–ª–µ–Ω context processor –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- –î–æ–±–∞–≤–ª–µ–Ω –≤–∏–∑—É–∞–ª—å–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ AttributeError —Å request.user
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è"

# 4. –ó–∞–ø—É—à—å—Ç–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
git push origin main
```

### –®–∞–≥ 2: –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ - –î–µ–ø–ª–æ–π

```bash
# 1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh root@46.62.167.17
# –ü–∞—Ä–æ–ª—å: vRgFjmEpCVvjXeLTJn7

# 2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd /var/www/pravoslavie_portal

# 3. –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
source venv/bin/activate

# 4. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –¥–µ–ø–ª–æ–π
./deploy.sh
```

**–ì–æ—Ç–æ–≤–æ!** ‚úÖ

---

## üéØ –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç deploy.sh

–í–∞—à —Å–∫—Ä–∏–ø—Ç `deploy.sh` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- ‚úÖ –ü–æ–¥—Ç—è–Ω–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ Git
- ‚úÖ –ü—Ä–∏–º–µ–Ω–∏—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
- ‚úÖ –°–æ–±–µ—Ä–µ—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
- ‚úÖ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç Gunicorn
- ‚úÖ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç Nginx

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

### 1. –û—Ç–∫—Ä–æ–π—Ç–µ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å:
```
https://dobrist.com/admin/core/sitesettings/1/change/
```

### 2. –í–∫–ª—é—á–∏—Ç–µ —Ä–µ–∂–∏–º –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è:
- ‚úÖ –ü–æ—Å—Ç–∞–≤—å—Ç–µ –≥–∞–ª–æ—á–∫—É "–†–µ–∂–∏–º –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è"
- üìù –í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- üíæ –ù–∞–∂–º–∏—Ç–µ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä:
```
https://dobrist.com/
```
- ‚úÖ –ö—Ä–∞—Å–Ω–∞—è –ø–æ–ª–æ—Å–∞ —Å–≤–µ—Ä—Ö—É: "–†–ï–ñ–ò–ú –û–ë–°–õ–£–ñ–ò–í–ê–ù–ò–Ø –ê–ö–¢–ò–í–ï–ù"
- ‚úÖ –°–∞–π—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ

### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:
- –û—Ç–∫—Ä–æ–π—Ç–µ —Ä–µ–∂–∏–º –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ (Ctrl+Shift+N)
- –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://dobrist.com/
- ‚úÖ –í–∏–¥–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è

### 5. –í—ã–∫–ª—é—á–∏—Ç–µ —Ä–µ–∂–∏–º:
- –°–Ω–∏–º–∏—Ç–µ –≥–∞–ª–æ—á–∫—É –≤ –∞–¥–º–∏–Ω–∫–µ
- –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ

---

## üìÅ –§–∞–π–ª—ã –¥–ª—è –∫–æ–º–º–∏—Ç–∞

**–û—Å–Ω–æ–≤–Ω—ã–µ:**
- ‚úÖ `core/middleware/maintenance.py`
- ‚úÖ `core/context_processors.py`
- ‚úÖ `config/settings_base.py`
- ‚úÖ `templates/includes/maintenance_indicator.html`
- ‚úÖ `templates/maintenance.html` (–µ—Å–ª–∏ –æ–±–Ω–æ–≤–ª—è–ª–∏)

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- ‚úÖ `MAINTENANCE_MODE_READY.md`
- ‚úÖ `MAINTENANCE_MODE_GUIDE.md`
- ‚úÖ `MAINTENANCE_CHECKLIST.md`
- ‚úÖ `MIDDLEWARE_ORDER_FIX.md`
- ‚úÖ `MAINTENANCE_READY_FINAL.md`

**–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:**
- ‚úÖ `test_maintenance_mode.py`
- ‚úÖ `maintenance_control.bat`

---

## üîß –ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —á–µ—Ä–µ–∑ SSH:
```bash
# –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å —Ä–µ–∂–∏–º–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è
python manage.py shell -c "from core.models import SiteSettings; s = SiteSettings.get_settings(); print(f'–†–µ–∂–∏–º: {\"üî¥ –í–ö–õ–Æ–ß–ï–ù\" if s.maintenance_mode else \"üü¢ –í–´–ö–õ–Æ–ß–ï–ù\"}')"

# –í–∫–ª—é—á–∏—Ç—å —Ä–µ–∂–∏–º
python manage.py shell -c "from core.models import SiteSettings; s = SiteSettings.get_settings(); s.maintenance_mode = True; s.maintenance_message = '–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ. –°–∫–æ—Ä–æ –≤–µ—Ä–Ω—ë–º—Å—è!'; s.save(); print('‚úÖ –í–∫–ª—é—á–µ–Ω')"

# –í—ã–∫–ª—é—á–∏—Ç—å —Ä–µ–∂–∏–º
python manage.py shell -c "from core.models import SiteSettings; s = SiteSettings.get_settings(); s.maintenance_mode = False; s.save(); print('‚úÖ –í—ã–∫–ª—é—á–µ–Ω')"
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤:
```bash
# –õ–æ–≥–∏ Gunicorn
sudo journalctl -u gunicorn -f

# –õ–æ–≥–∏ Nginx
sudo tail -f /var/log/nginx/error.log
```

---

## üö® –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –û—à–∏–±–∫–∞ "no attribute 'user'"
**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ middleware

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `config/settings_production.py`:
```python
MIDDLEWARE = [
    # ...
    'django.contrib.auth.middleware.AuthenticationMiddleware',  # ‚Üê –°–ù–ê–ß–ê–õ–ê
    # ...
    'core.middleware.maintenance.MaintenanceModeMiddleware',  # ‚Üê –ü–û–¢–û–ú
]
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
**–ü—Ä–∏—á–∏–Ω–∞:** Context processor –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ settings:
```python
'context_processors': [
    # ...
    'core.context_processors.maintenance_context',
]
```

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –ò–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à Django
python manage.py shell -c "from django.core.cache import cache; cache.clear(); print('‚úÖ –ö–µ—à –æ—á–∏—â–µ–Ω')"

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
sudo systemctl restart gunicorn nginx
```

---

## üìù –ß–µ–∫-–ª–∏—Å—Ç –¥–µ–ø–ª–æ—è

### –õ–æ–∫–∞–ª—å–Ω–æ:
- [ ] –ü—Ä–æ–≤–µ—Ä–∏–ª –∏–∑–º–µ–Ω–µ–Ω–∏—è: `git status`
- [ ] –î–æ–±–∞–≤–∏–ª —Ñ–∞–π–ª—ã: `git add .`
- [ ] –°–æ–∑–¥–∞–ª –∫–æ–º–º–∏—Ç: `git commit -m "..."`
- [ ] –ó–∞–ø—É—à–∏–ª: `git push origin main`

### –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:
- [ ] –ü–æ–¥–∫–ª—é—á–∏–ª—Å—è: `ssh root@46.62.167.17`
- [ ] –ü–µ—Ä–µ—à–µ–ª –≤ –ø—Ä–æ–µ–∫—Ç: `cd /var/www/pravoslavie_portal`
- [ ] –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª venv: `source venv/bin/activate`
- [ ] –í—ã–ø–æ–ª–Ω–∏–ª –¥–µ–ø–ª–æ–π: `./deploy.sh`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏–ª –∞–¥–º–∏–Ω–∫—É: https://dobrist.com/admin/core/sitesettings/1/change/
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª —Ä–µ–∂–∏–º –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è
- [ ] –í—ã–∫–ª—é—á–∏–ª —Ä–µ–∂–∏–º

---

## üéâ –ì–æ—Ç–æ–≤–æ!

**–ü—Ä–æ—Ü–µ—Å—Å –¥–µ–ø–ª–æ—è:**
1. **–õ–æ–∫–∞–ª—å–Ω–æ:** `git add . && git commit -m "..." && git push`
2. **–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:** `./deploy.sh`
3. **–ì–æ—Ç–æ–≤–æ!** ‚úÖ

**–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω–µ:**
- üåê https://dobrist.com/admin/core/sitesettings/1/change/
- üì± SSH: `ssh root@46.62.167.17`
- üîß –ü—É—Ç—å: `/var/www/pravoslavie_portal`
