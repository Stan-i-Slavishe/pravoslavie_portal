# üöÄ –î–µ–ø–ª–æ–π Google reCAPTCHA v3 –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω —Å–µ—Ä–≤–µ—Ä

## üéØ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –¥–µ–ø–ª–æ—é

### ‚úÖ –ß—Ç–æ —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ:
1. **–†–µ–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏ reCAPTCHA** –¥–ª—è –¥–æ–º–µ–Ω–∞ `dobrist.com`
2. **–ö–∞—Å—Ç–æ–º–Ω–∞—è —Ñ–æ—Ä–º–∞** —Å —É—Å–ª–æ–≤–Ω–æ–π –∫–∞–ø—á–µ–π (–≤–∫–ª—é—á–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ)
3. **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** –≤ `settings_production.py`
4. **django-recaptcha** –≤ requirements.txt
5. **ACCOUNT_FORMS** –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## üß™ –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:
```bash
python check_production_recaptcha.py
```

### –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫:
```python
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤ settings_production.py:
DEBUG = False  # ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!
RECAPTCHA_PUBLIC_KEY = '6LeD-dErAAAAAPFCCTD0oEDipeyX8FYmrbJgZ9Ri'  # ‚úÖ –†–µ–∞–ª—å–Ω—ã–π –∫–ª—é—á
RECAPTCHA_PRIVATE_KEY = '6LeD-dErAAAAAD6Asd70b0wN98n-YFi0BunWmm2f'  # ‚úÖ –†–µ–∞–ª—å–Ω—ã–π –∫–ª—é—á
ALLOWED_HOSTS = ['dobrist.com', 'www.dobrist.com', '46.62.167.17']  # ‚úÖ –î–æ–º–µ–Ω—ã
```

## üöÄ –ú–µ—Ç–æ–¥—ã –¥–µ–ø–ª–æ—è

### –ú–µ—Ç–æ–¥ 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π
```bash
chmod +x deploy_with_recaptcha_check.sh
./deploy_with_recaptcha_check.sh
```

### –ú–µ—Ç–æ–¥ 2: –†—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π
```bash
# 1. –ö–æ–º–º–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π
git add .
git commit -m "üîí –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ Google reCAPTCHA v3 –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞"
git push origin main

# 2. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
ssh your-server
cd /path/to/pravoslavie_portal
git pull origin main
pip install -r requirements.txt
python manage.py migrate
python manage.py collectstatic --noinput

# 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤  
sudo systemctl restart gunicorn
sudo systemctl restart nginx
```

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:
- –û—Ç–∫—Ä–æ–π—Ç–µ: `https://dobrist.com/accounts/signup/`
- **–î–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤–∏–¥–Ω–æ:** "–§–æ—Ä–º–∞ –∑–∞—â–∏—â–µ–Ω–∞ Google reCAPTCHA" üõ°Ô∏è
- **–î–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–Ω–∞—á–æ–∫** reCAPTCHA –≤ –ø—Ä–∞–≤–æ–º –Ω–∏–∂–Ω–µ–º —É–≥–ª—É
- **–ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å** –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞

### 2. –¢–µ—Å—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:
```
Email: test-production-user@example.com
–ü–∞—Ä–æ–ª—å: SecureProductionPassword123!
–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ: SecureProductionPassword123!
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –£—Å–ø–µ—à–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∫–∞–ø—á–∏

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ Django:
```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
tail -f /var/log/pravoslavie_portal/django.log | grep -i recaptcha
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ reCAPTCHA

### Google reCAPTCHA Admin –ø–∞–Ω–µ–ª—å:
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ: https://www.google.com/recaptcha/admin
2. –í—ã–±–µ—Ä–∏—Ç–µ —Å–∞–π—Ç: `dobrist.com`
3. –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ:
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
   - –ü—Ä–æ—Ü–µ–Ω—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –±–æ—Ç–æ–≤  
   - –ì—Ä–∞—Ñ–∏–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - –û—Ü–µ–Ω–∫–∏ –¥–æ–≤–µ—Ä–∏—è (–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å ‚â• 0.85)

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:
```python
# –í settings_production.py –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏:

# –ï—Å–ª–∏ –º–Ω–æ–≥–æ –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π:
RECAPTCHA_REQUIRED_SCORE = 0.7  # –°–Ω–∏–∑–∏—Ç—å –ø–æ—Ä–æ–≥

# –ï—Å–ª–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç –±–æ—Ç—ã:
RECAPTCHA_REQUIRED_SCORE = 0.9  # –ü–æ–≤—ã—Å–∏—Ç—å –ø–æ—Ä–æ–≥
```

## üêõ –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞: "reCAPTCHA validation failed" –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
**–ü—Ä–∏—á–∏–Ω—ã:**
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–ª—é—á–∏ –¥–ª—è –¥–æ–º–µ–Ω–∞
- –ü—Ä–æ–±–ª–µ–º—ã —Å DNS
- –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –¥–æ—Å—Ç—É–ø –∫ google.com

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ Google API —Å —Å–µ—Ä–≤–µ—Ä–∞
curl -I https://www.google.com/recaptcha/api.js

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å DNS –¥–æ–º–µ–Ω–∞
nslookup dobrist.com

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ Google Admin
# https://www.google.com/recaptcha/admin
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ö–∞–ø—á–∞ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
**–ü—Ä–∏—á–∏–Ω—ã:**
- DEBUG=True –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
- –û—à–∏–±–∫–∏ JavaScript

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ DEBUG=False
python manage.py shell -c "from django.conf import settings; print('DEBUG:', settings.DEBUG)"

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
python manage.py collectstatic --noinput

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏
```

### –ü—Ä–æ–±–ª–µ–º–∞: –§–æ—Ä–º–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –º–æ–±–∏–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏
**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å CSS
- –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ reCAPTCHA –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å touch —Å–æ–±—ã—Ç–∏—è

## üîß –¢–æ–Ω–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ—Ä–æ–≥–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
```python
# –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π (–º–Ω–æ–≥–æ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫)
RECAPTCHA_REQUIRED_SCORE = 0.9

# –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π) 
RECAPTCHA_REQUIRED_SCORE = 0.85

# –õ–∏–±–µ—Ä–∞–ª—å–Ω—ã–π (–º–µ–Ω—å—à–µ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫)
RECAPTCHA_REQUIRED_SCORE = 0.7
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ reCAPTCHA:
```python
# –î–æ–±–∞–≤–∏—Ç—å –≤ settings_production.py
LOGGING = {
    'version': 1,
    'handlers': {
        'recaptcha_file': {
            'class': 'logging.FileHandler',
            'filename': '/var/log/pravoslavie_portal/recaptcha.log',
        },
    },
    'loggers': {
        'django_recaptcha': {
            'handlers': ['recaptcha_file'],
            'level': 'INFO',
        },
    },
}
```

## ‚úÖ Checklist –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ –¥–µ–ø–ª–æ—é

- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ `python check_production_recaptcha.py` –ø—Ä–æ—Ö–æ–¥–∏—Ç
- [ ] DEBUG=False –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö  
- [ ] –†–µ–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏ reCAPTCHA –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] –î–æ–º–µ–Ω—ã dobrist.com –∏ www.dobrist.com –≤ ALLOWED_HOSTS
- [ ] django-recaptcha==4.0.0 –≤ requirements.txt
- [ ] –§–æ—Ä–º–∞ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] Git –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–∫–æ–º–º–∏—á–µ–Ω—ã
- [ ] –°–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –¥–µ–ø–ª–æ—é

## üéâ –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è

### –ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç:
1. ‚úÖ **–ù–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ (dobrist.com):** –ü–æ–ª–Ω–∞—è –∑–∞—â–∏—Ç–∞ reCAPTCHA –∞–∫—Ç–∏–≤–Ω–∞
2. ‚úÖ **–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ (127.0.0.1:8000):** –ö–∞–ø—á–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
3. ‚úÖ **–ó–∞—â–∏—Ç–∞ –æ—Ç –±–æ—Ç–æ–≤:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
4. ‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ Google reCAPTCHA Admin
5. ‚úÖ **UX:** –ù–µ–≤–∏–¥–∏–º–∞—è –∑–∞—â–∏—Ç–∞ –Ω–µ –º–µ—à–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º

### –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! üéä
–í–∞—à –ø—Ä–∞–≤–æ—Å–ª–∞–≤–Ω—ã–π –ø–æ—Ä—Ç–∞–ª —Ç–µ–ø–µ—Ä—å –∏–º–µ–µ—Ç –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—É—é –∑–∞—â–∏—Ç—É –æ—Ç –±–æ—Ç–æ–≤ –∏ —Å–ø–∞–º–∞ –Ω–∞ —ç—Ç–∞–ø–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π!

---

**üìà –ü—Ä–æ–≥—Ä–µ—Å—Å –ø—Ä–æ–µ–∫—Ç–∞: 99% –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–º—É –∑–∞–ø—É—Å–∫—É!** üöÄ
