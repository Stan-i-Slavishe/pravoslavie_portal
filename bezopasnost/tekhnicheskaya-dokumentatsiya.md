# üõ°Ô∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

## üìã **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã**

### üîß **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**

1. **BlacklistMiddleware** - –ü–µ—Ä–≤—ã–π –±–∞—Ä—å–µ—Ä
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ IP
   - –ë–ª–æ–∫–∏—Ä—É–µ—Ç –¥–æ—Å—Ç—É–ø –¥–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞

2. **AdvancedSecurityMiddleware** - –û—Å–Ω–æ–≤–Ω–∞—è –∑–∞—â–∏—Ç–∞
   - –î–µ—Ç–µ–∫—Ü–∏—è –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
   - Rate limiting  
   - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∞—Ç–∞–∫

3. **MonitoringMiddleware** - –ù–∞–±–ª—é–¥–µ–Ω–∏–µ
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
   - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—à–∏–±–æ–∫

### üìÇ **–§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞**
```
core/middleware/advanced_security.py     # –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥
core/management/commands/security_admin.py  # CLI –∫–æ–º–∞–Ω–¥—ã
config/settings.py                      # –ù–∞—Å—Ç—Ä–æ–π–∫–∏
logs/django.log                         # –õ–æ–≥–∏
```

---

## üîç **–î–µ—Ç–µ–∫—Ü–∏—è –∞—Ç–∞–∫**

### üö® **SQL Injection –ø–∞—Ç—Ç–µ—Ä–Ω—ã**
```python
r'union\s+select',
r'drop\s+table',
r'delete\s+from',
r'insert\s+into',
r'update\s+.*set',
r'exec\s*\(',
r'sp_executesql',
r'xp_cmdshell',
```

### üï∑Ô∏è **XSS –ø–∞—Ç—Ç–µ—Ä–Ω—ã**
```python
r'<script[^>]*>',
r'javascript:',
r'vbscript:',
r'onload\s*=',
r'onerror\s*=',
r'<iframe[^>]*>',
```

### üìÅ **Path Traversal –ø–∞—Ç—Ç–µ—Ä–Ω—ã**
```python
r'\.\./',
r'\.\.\\',
r'\/\.\.\/',
r'\\\.\.\\',
```

### üîê **Admin Scan –ø–∞—Ç—Ç–µ—Ä–Ω—ã**
```python
r'wp-admin',
r'wp-login',
r'phpmyadmin',
r'admin\.php',
r'config\.php',
r'\.env',
r'\.git',
```

---

## ‚ö° **Rate Limiting**

### üìä **–õ–∏–º–∏—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é**

**–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (DEBUG=True):**
```python
{
    'requests_per_minute': 60,
    'requests_per_hour': 1000,
    'mobile_feedback_per_hour': 10,
    'login_attempts_per_hour': 10,
    'admin_attempts_per_hour': 5,
    'api_requests_per_minute': 30,
}
```

**–ü—Ä–æ–¥–∞–∫—à–µ–Ω (DEBUG=False):**
```python
{
    'requests_per_minute': 30,
    'requests_per_hour': 500,
    'mobile_feedback_per_hour': 5,
    'login_attempts_per_hour': 5,
    'admin_attempts_per_hour': 3,
    'api_requests_per_minute': 15,
}
```

### üéØ **–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã**

- `/api/mobile-feedback/` - –û–≥—Ä–∞–Ω–∏—á–µ–Ω –æ—Ç–¥–µ–ª—å–Ω–æ
- `/accounts/login/` - –ó–∞—â–∏—Ç–∞ –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞
- `/admin/login/` - –°—Ç—Ä–æ–∂–µ —á–µ–º –æ–±—ã—á–Ω—ã–π –ª–æ–≥–∏–Ω
- `/api/*` - –û–±—â–∏–µ API –ª–∏–º–∏—Ç—ã

---

## üóÑÔ∏è **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ**

### üíæ **Redis (–ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–æ)**
```python
# –ö–ª—é—á–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
"blacklist:{ip}" - –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ IP
"whitelist:{ip}" - –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ IP

# –ö–ª—é—á–∏ —Å—á–µ—Ç—á–∏–∫–æ–≤
"rate:{ip}:{minute}" - –°—á–µ—Ç—á–∏–∫ –≤ –º–∏–Ω—É—Ç—É
"rate_hour:{ip}:{hour}" - –°—á–µ—Ç—á–∏–∫ –≤ —á–∞—Å
"api_feedback:{ip}:{hour}" - API –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
"login_attempts:{ip}:{hour}" - –ü–æ–ø—ã—Ç–∫–∏ –≤—Ö–æ–¥–∞
```

### üè† **Local Memory (fallback)**
- –ï—Å–ª–∏ Redis –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- –†–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞
- –î–∞–Ω–Ω—ã–µ —Ç–µ—Ä—è—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ

---

## üìù **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**

### üìä **–£—Ä–æ–≤–Ω–∏ –ª–æ–≥–æ–≤**
```python
logger.info()    # –û–±—ã—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
logger.warning() # –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
logger.error()   # –ê—Ç–∞–∫–∏ –∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
```

### üìã **–¢–∏–ø—ã —Å–æ–±—ã—Ç–∏–π**

**–û–±—ã—á–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è:**
```
POST –∑–∞–ø—Ä–æ—Å –æ—Ç 127.0.0.1 –∫ /analytics/track-event/
INFO "GET / HTTP/1.1" 200 79857
```

**–ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:**
```
SUSPICIOUS PATTERN: drop\s+table in data from 192.168.1.100
SUSPICIOUS PATTERNS DETECTED from 192.168.1.100: /search
RATE LIMITED IP 192.168.1.100: Rate limit exceeded
```

**–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏:**
```
BLOCKED IP 192.168.1.100: Suspicious patterns detected (severity: high, duration: 86400s)
BLOCKED IP 192.168.1.100 trying to access
```

**–û—à–∏–±–∫–∏:**
```
ERROR 404 –æ—Ç 127.0.0.1 –∫ /search
ERROR 403 –æ—Ç 192.168.1.100 –∫ /admin.php
SLOW REQUEST (3.24s) –æ—Ç 10.0.0.1 –∫ /heavy-page
```

---

## üîß **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è**

### ‚öôÔ∏è **–ò–∑–º–µ–Ω–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤**

–í `config/settings.py`:
```python
SECURITY_RATE_LIMITS = {
    'requests_per_minute': 100,  # –£–≤–µ–ª–∏—á–∏—Ç—å –¥–ª—è –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏
    'requests_per_hour': 2000,   # –£–≤–µ–ª–∏—á–∏—Ç—å –¥–ª—è —Å–æ–±—ã—Ç–∏–π
    'login_attempts_per_hour': 3, # –£–º–µ–Ω—å—à–∏—Ç—å –¥–ª—è —Å—Ç—Ä–æ–≥–æ—Å—Ç–∏
}
```

### üéØ **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤**

–í `core/middleware/advanced_security.py`:
```python
self.suspicious_patterns = [
    # –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã...
    r'your_custom_pattern',  # –í–∞—à –ø–∞—Ç—Ç–µ—Ä–Ω
    r'malicious_payload',    # –ï—â–µ –æ–¥–∏–Ω
]
```

### ü§ñ **–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ whitelist**

```python
self.bot_whitelist = [
    'googlebot',
    'bingbot', 
    'yandexbot',
    'your_custom_bot',  # –î–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–π –±–æ—Ç
]
```

---

## üöÄ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**

### üìà **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Redis** –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ª–∏–º–∏—Ç—ã** –¥–ª—è –≤–∞—à–µ–π –Ω–∞–≥—Ä—É–∑–∫–∏
3. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ª–æ–≥–∏** –Ω–∞ –ª–æ–∂–Ω—ã–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è
4. **–†–µ–≥—É–ª—è—Ä–Ω–æ –æ—á–∏—â–∞–π—Ç–µ** —Å—Ç–∞—Ä—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

### üìä **–ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**

- –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ middleware: < 1ms
- –ü–∞–º—è—Ç—å –Ω–∞ IP: ~100 –±–∞–π—Ç
- –í–ª–∏—è–Ω–∏–µ –Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—å: < 5%
- CPU –Ω–∞–≥—Ä—É–∑–∫–∞: –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è

---

## üîí **Security Headers**

### üìã **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ–º—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏**

```http
X-Content-Type-Options: nosniff
X-Frame-Options: DENY
X-XSS-Protection: 1; mode=block
Referrer-Policy: strict-origin-when-cross-origin
Permissions-Policy: geolocation=(), microphone=(), camera=()
Content-Security-Policy: [—Å—Ç—Ä–æ–≥–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞]
```

### üõ°Ô∏è **Content Security Policy**

```
default-src 'self';
script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net;
style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net;
img-src 'self' data: https:;
connect-src 'self';
frame-ancestors 'none';
```

---

## üß™ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**

### üîç **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã**

```bash
python test_security.py              # –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã
python manage.py security_admin --test-patterns  # –¢–µ—Å—Ç –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
```

### üö® **–†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—Ç–∞–∫**

```bash
# SQL Injection
curl "http://127.0.0.1:8000/?id=1; DROP TABLE users"

# XSS
curl "http://127.0.0.1:8000/search?q=<script>alert('xss')</script>"

# Path Traversal  
curl "http://127.0.0.1:8000/files?path=../../etc/passwd"

# Admin Scan
curl "http://127.0.0.1:8000/wp-admin/admin.php"
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** HTTP 403 Forbidden

---

## üìû **Troubleshooting**

### üîß **–ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã**

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–∏—Å—Ç–µ–º–∞ –±–ª–æ–∫–∏—Ä—É–µ—Ç –ª–µ–≥–∏—Ç–∏–º–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
**–†–µ—à–µ–Ω–∏–µ:** 
```bash
python manage.py security_admin --clear-all
# –£–≤–µ–ª–∏—á–∏—Ç—å –ª–∏–º–∏—Ç—ã –≤ settings.py
```

**–ü—Ä–æ–±–ª–µ–º–∞:** Unicode –æ—à–∏–±–∫–∏ –≤ –ª–æ–≥–∞—Ö  
**–†–µ—à–µ–Ω–∏–µ:** –£–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ - —É–±—Ä–∞–Ω—ã —ç–º–æ–¥–∑–∏ –∏–∑ –ª–æ–≥–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:** Redis –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
**–†–µ—à–µ–Ω–∏–µ:** –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—Å—è –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –ª–∏–º–∏—Ç—ã

---

## üìä **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ**

### üìà **–ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è**

- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö IP –≤ —á–∞—Å
- –ü—Ä–æ—Ü–µ–Ω—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤  
- –¢–∏–ø—ã –∞—Ç–∞–∫ –∏ –∏—Ö —á–∞—Å—Ç–æ—Ç–∞
- –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ —Å–∏—Å—Ç–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –õ–æ–∂–Ω—ã–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è

### üîî **–ê–ª–µ—Ä—Ç—ã**

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏:
- –ë–æ–ª–µ–µ 10% –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –ú–∞—Å—Å–æ–≤—ã—Ö –∞—Ç–∞–∫–∞—Ö (>100 IP –≤ —á–∞—Å)
- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö –≤ –ª–æ–≥–∞—Ö
- –ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Redis

---

*–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏*  
*–ü—Ä–∞–≤–æ—Å–ª–∞–≤–Ω—ã–π –ø–æ—Ä—Ç–∞–ª "–î–æ–±—Ä—ã–µ –∏—Å—Ç–æ—Ä–∏–∏"*  
*–í–µ—Ä—Å–∏—è: 1.0 | –ê–≤–≥—É—Å—Ç 2025*
