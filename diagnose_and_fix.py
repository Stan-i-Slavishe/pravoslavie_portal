#!/usr/bin/env python
"""
–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞: –ø—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
"""

import os
import sys
import django

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Django
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'config.settings')
django.setup()

from pwa.models import DailyOrthodoxInfo, OrthodoxEvent

def check_database():
    """–ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö"""
    print("üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...")
    
    print("\nüìÖ DailyOrthodoxInfo:")
    total = DailyOrthodoxInfo.objects.count()
    print(f"   –í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π: {total}")
    
    if total > 0:
        print("   –ü–æ—Å–ª–µ–¥–Ω–∏–µ 10 –∑–∞–ø–∏—Å–µ–π:")
        for info in DailyOrthodoxInfo.objects.all()[:10]:
            print(f"   {info.day:02d}.{info.month:02d} - {info.get_fasting_type_display()} - {info.fasting_description}")
    
    print("\n‚õ™ OrthodoxEvent:")
    total_events = OrthodoxEvent.objects.count()
    print(f"   –í—Å–µ–≥–æ —Å–æ–±—ã—Ç–∏–π: {total_events}")
    
    if total_events > 0:
        print("   –°–æ–±—ã—Ç–∏—è:")
        for event in OrthodoxEvent.objects.all():
            print(f"   {event.day:02d}.{event.month:02d} - {event.title}")
    
    print("\nüéØ –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ 21 –∞–≤–≥—É—Å—Ç–∞:")
    try:
        info21 = DailyOrthodoxInfo.objects.get(month=8, day=21)
        print(f"   ‚úÖ –ù–∞–π–¥–µ–Ω–∞ –∑–∞–ø–∏—Å—å: {info21.get_fasting_type_display()}")
        print(f"   –û–ø–∏—Å–∞–Ω–∏–µ: {info21.fasting_description}")
    except DailyOrthodoxInfo.DoesNotExist:
        print("   ‚ùå –ó–∞–ø–∏—Å–∏ –¥–ª—è 21 –∞–≤–≥—É—Å—Ç–∞ –ù–ï–¢ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö!")
    
    return total > 0

def create_test_data():
    """–°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∞–≤–≥—É—Å—Ç–∞"""
    print("\nüîß –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∞–≤–≥—É—Å—Ç–∞...")
    
    august_data = {
        21: {
            'fasting_type': 'strict_fast',
            'description': '–£—Å–ø–µ–Ω—Å–∫–∏–π –ø–æ—Å—Ç: –≥–æ—Ä—è—á–∞—è –ø–∏—â–∞ –±–µ–∑ –º–∞—Å–ª–∞',
            'allowed_food': '''üç≤ <strong>–£—Å–ø–µ–Ω—Å–∫–∏–π –ø–æ—Å—Ç - –≥–æ—Ä—è—á–µ–µ –±–µ–∑ –º–∞—Å–ª–∞:</strong>

‚úÖ <strong>–†–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è:</strong>
‚Ä¢ –ö–∞—à–∏ –Ω–∞ –≤–æ–¥–µ: –≥—Ä–µ—á–Ω–µ–≤–∞—è, –æ–≤—Å—è–Ω–∞—è, —Ä–∏—Å–æ–≤–∞—è, –ø—à–µ–Ω–Ω–∞—è
‚Ä¢ –ü–æ—Å—Ç–Ω—ã–µ —Å—É–ø—ã: –æ–≤–æ—â–Ω—ã–µ, –≥—Ä–∏–±–Ω—ã–µ, —â–∏ –ø–æ—Å—Ç–Ω—ã–µ
‚Ä¢ –û—Ç–≤–∞—Ä–Ω—ã–µ –æ–≤–æ—â–∏: –∫–∞—Ä—Ç–æ—Ñ–µ–ª—å, –º–æ—Ä–∫–æ–≤—å, —Å–≤–µ–∫–ª–∞, –∫–∞–ø—É—Å—Ç–∞
‚Ä¢ –ö–∞—Ä—Ç–æ—Ñ–µ–ª—å –ø–µ—á–µ–Ω—ã–π –≤ –º—É–Ω–¥–∏—Ä–µ
‚Ä¢ –¢—É—à–µ–Ω—ã–µ –æ–≤–æ—â–∏ –±–µ–∑ –º–∞—Å–ª–∞
‚Ä¢ –ì—Ä–∏–±—ã –æ—Ç–≤–∞—Ä–Ω—ã–µ, —Ç—É—à–µ–Ω—ã–µ (–±–µ–∑ –º–∞—Å–ª–∞)
‚Ä¢ –ë–æ–±–æ–≤—ã–µ: –≥–æ—Ä–æ—Ö, —Ñ–∞—Å–æ–ª—å, —á–µ—á–µ–≤–∏—Ü–∞
‚Ä¢ –ú–∞–∫–∞—Ä–æ–Ω—ã (–∏–∑ —Ç–≤–µ—Ä–¥—ã—Ö —Å–æ—Ä—Ç–æ–≤ –ø—à–µ–Ω–∏—Ü—ã)
‚Ä¢ –ö–æ–º–ø–æ—Ç—ã –∏–∑ —Å–≤–µ–∂–∏—Ö —Ñ—Ä—É–∫—Ç–æ–≤
‚Ä¢ –ß–∞–π, –∫–æ—Ñ–µ, —Ç—Ä–∞–≤—è–Ω—ã–µ –æ—Ç–≤–∞—Ä—ã

‚ùå <strong>–ó–∞–ø—Ä–µ—â–∞–µ—Ç—Å—è:</strong>
‚Ä¢ –†–∞—Å—Ç–∏—Ç–µ–ª—å–Ω–æ–µ –º–∞—Å–ª–æ –¥–ª—è –≥–æ—Ç–æ–≤–∫–∏
‚Ä¢ –ñ–∞—Ä–µ–Ω–∞—è –ø–∏—â–∞
‚Ä¢ –ü—Ä–æ–¥—É–∫—Ç—ã –∂–∏–≤–æ—Ç–Ω–æ–≥–æ –ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏—è
‚Ä¢ –°–ª–∏–≤–æ—á–Ω–æ–µ –º–∞—Å–ª–æ

üí° <strong>–†–µ—Ü–µ–ø—Ç:</strong> –û–≤–æ—â–Ω–æ–µ —Ä–∞–≥—É –±–µ–∑ –º–∞—Å–ª–∞ - —Ç—É—à–∏—Ç–µ –æ–≤–æ—â–∏ –≤ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–º —Å–æ–∫—É''',
            'spiritual_note': '–ì–æ—Ä—è—á–∞—è –ø–∏—â–∞ –±–µ–∑ –º–∞—Å–ª–∞. –í—Ä–µ–º—è —É–º–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –∏ –¥—É—Ö–æ–≤–Ω–æ–≥–æ —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–µ–Ω–∏—è.'
        },
        29: {
            'fasting_type': 'no_fast',
            'description': '–û—Ä–µ—Ö–æ–≤—ã–π –°–ø–∞—Å (–ù–µ—Ä—É–∫–æ—Ç–≤–æ—Ä–Ω—ã–π –û–±—Ä–∞–∑)',
            'allowed_food': '''üå∞ <strong>–û—Ä–µ—Ö–æ–≤—ã–π –°–ø–∞—Å - –ø–æ—Å—Ç–∞ –Ω–µ—Ç!</strong>

–¢—Ä–µ—Ç–∏–π –°–ø–∞—Å - –¥–µ–Ω—å –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∏—è –ù–µ—Ä—É–∫–æ—Ç–≤–æ—Ä–Ω–æ–≥–æ –û–±—Ä–∞–∑–∞ –°–ø–∞—Å–∏—Ç–µ–ª—è.

üçΩÔ∏è <strong>–ú–æ–∂–Ω–æ —É–ø–æ—Ç—Ä–µ–±–ª—è—Ç—å:</strong>
‚Ä¢ –õ—é–±—É—é –ø–∏—â—É (–ø–æ—Å—Ç —É–∂–µ –∑–∞–≤–µ—Ä—à–µ–Ω)
‚Ä¢ –û—Ä–µ—Ö–∏ –Ω–æ–≤–æ–≥–æ —É—Ä–æ–∂–∞—è
‚Ä¢ –•–ª–µ–± –∏–∑ –Ω–æ–≤–æ–≥–æ –∑–µ—Ä–Ω–∞
‚Ä¢ –ü—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–µ –±–ª—é–¥–∞

üå∞ <strong>–¢—Ä–∞–¥–∏—Ü–∏–∏:</strong>
‚Ä¢ –û—Å–≤—è—â–µ–Ω–∏–µ –æ—Ä–µ—Ö–æ–≤ –∏ —Ö–ª–µ–±–∞
‚Ä¢ –ü–æ–∫—É–ø–∫–∞ —Ç–∫–∞–Ω–µ–π –∏ —Ö–æ–ª—Å—Ç–æ–≤
‚Ä¢ –ó–∞–≥–æ—Ç–æ–≤–∫–∞ –æ—Ä–µ—Ö–æ–≤ –Ω–∞ –∑–∏–º—É''',
            'spiritual_note': 'üå∞ –û—Ä–µ—Ö–æ–≤—ã–π –°–ø–∞—Å! –î–µ–Ω—å –ù–µ—Ä—É–∫–æ—Ç–≤–æ—Ä–Ω–æ–≥–æ –û–±—Ä–∞–∑–∞ –°–ø–∞—Å–∏—Ç–µ–ª—è. –í—Ä–µ–º—è –±–ª–∞–≥–æ–¥–∞—Ä–µ–Ω–∏—è –∑–∞ —É—Ä–æ–∂–∞–π –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ –æ—Å–µ–Ω–∏.'
        }
    }
    
    created_count = 0
    for day, data in august_data.items():
        info, created = DailyOrthodoxInfo.objects.get_or_create(
            month=8,
            day=day,
            defaults={
                'fasting_type': data['fasting_type'],
                'fasting_description': data['description'],
                'allowed_food': data['allowed_food'],
                'spiritual_note': data['spiritual_note']
            }
        )
        
        if not created:
            # –û–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∑–∞–ø–∏—Å—å
            info.fasting_type = data['fasting_type']
            info.fasting_description = data['description']
            info.allowed_food = data['allowed_food']
            info.spiritual_note = data['spiritual_note']
            info.save()
        
        action = "–°–æ–∑–¥–∞–Ω–∞" if created else "–û–±–Ω–æ–≤–ª–µ–Ω–∞"
        print(f"   ‚úÖ {action} –∑–∞–ø–∏—Å—å –¥–ª—è {day} –∞–≤–≥—É—Å—Ç–∞")
        created_count += 1
    
    return created_count

if __name__ == "__main__":
    print("üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∞–≤–æ—Å–ª–∞–≤–Ω–æ–≥–æ –∫–∞–ª–µ–Ω–¥–∞—Ä—è")
    print("=" * 60)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    has_data = check_database()
    
    if not has_data:
        print("\n‚ùå –í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –ù–ï–¢ –∑–∞–ø–∏—Å–µ–π –æ –ø–æ—Å—Ç–∞—Ö!")
        print("üîß –°–æ–∑–¥–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ...")
        created = create_test_data()
        print(f"\n‚úÖ –°–æ–∑–¥–∞–Ω–æ {created} –∑–∞–ø–∏—Å–µ–π")
    else:
        print("\nüîß –û–±–Ω–æ–≤–ª—è–µ–º –∫–ª—é—á–µ–≤—ã–µ –∑–∞–ø–∏—Å–∏...")
        created = create_test_data()
        print(f"\n‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ {created} –∑–∞–ø–∏—Å–µ–π")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    print("\n" + "="*60)
    check_database()
    
    print("\nüéØ –ì–û–¢–û–í–û! –¢–µ–ø–µ—Ä—å –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ –±—Ä–∞—É–∑–µ—Ä–µ")
    print("üìç URL –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ API: http://127.0.0.1:8000/pwa/api/daily-orthodox/2025/8/21/")
