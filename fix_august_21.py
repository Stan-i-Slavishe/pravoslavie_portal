#!/usr/bin/env python
"""
–ë–´–°–¢–†–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ 21 –∞–≤–≥—É—Å—Ç–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
"""

import os
import sys
import django

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Django
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'config.settings')
django.setup()

from datetime import date
from pwa.models import DailyOrthodoxInfo, OrthodoxEvent

def fix_august_21():
    """–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è 21 –∞–≤–≥—É—Å—Ç–∞"""
    print("üîß –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è 21 –∞–≤–≥—É—Å—Ç–∞...")
    
    try:
        # –ü–æ–ª—É—á–∞–µ–º –∏–ª–∏ —Å–æ–∑–¥–∞–µ–º –∑–∞–ø–∏—Å—å –¥–ª—è 21 –∞–≤–≥—É—Å—Ç–∞
        daily_info, created = DailyOrthodoxInfo.objects.get_or_create(
            month=8,
            day=21
        )
        
        # 21 –∞–≤–≥—É—Å—Ç–∞ 2025 - —á–µ—Ç–≤–µ—Ä–≥, –£—Å–ø–µ–Ω—Å–∫–∏–π –ø–æ—Å—Ç: –≥–æ—Ä—è—á–µ–µ –±–µ–∑ –º–∞—Å–ª–∞
        daily_info.fasting_type = 'strict_fast'
        daily_info.fasting_description = '–£—Å–ø–µ–Ω—Å–∫–∏–π –ø–æ—Å—Ç: –≥–æ—Ä—è—á–∞—è –ø–∏—â–∞ –±–µ–∑ –º–∞—Å–ª–∞'
        daily_info.allowed_food = '''üç≤ <strong>–£—Å–ø–µ–Ω—Å–∫–∏–π –ø–æ—Å—Ç - –≥–æ—Ä—è—á–µ–µ –±–µ–∑ –º–∞—Å–ª–∞:</strong>

‚úÖ <strong>–†–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è:</strong>
‚Ä¢ –ö–∞—à–∏ –Ω–∞ –≤–æ–¥–µ: –≥—Ä–µ—á–Ω–µ–≤–∞—è, –æ–≤—Å—è–Ω–∞—è, —Ä–∏—Å–æ–≤–∞—è, –ø—à–µ–Ω–Ω–∞—è
‚Ä¢ –ü–æ—Å—Ç–Ω—ã–µ —Å—É–ø—ã: –æ–≤–æ—â–Ω—ã–µ, –≥—Ä–∏–±–Ω—ã–µ, —â–∏ –ø–æ—Å—Ç–Ω—ã–µ
‚Ä¢ –û—Ç–≤–∞—Ä–Ω—ã–µ –æ–≤–æ—â–∏: –∫–∞—Ä—Ç–æ—Ñ–µ–ª—å, –º–æ—Ä–∫–æ–≤—å, —Å–≤–µ–∫–ª–∞, –∫–∞–ø—É—Å—Ç–∞
‚Ä¢ –ö–∞—Ä—Ç–æ—Ñ–µ–ª—å –ø–µ—á–µ–Ω—ã–π –≤ –º—É–Ω–¥–∏—Ä–µ
‚Ä¢ –¢—É—à–µ–Ω—ã–µ –æ–≤–æ—â–∏ –±–µ–∑ –º–∞—Å–ª–∞
‚Ä¢ –ì—Ä–∏–±—ã –æ—Ç–≤–∞—Ä–Ω—ã–µ, —Ç—É—à–µ–Ω—ã–µ (–±–µ–∑ –º–∞—Å–ª–∞)
‚Ä¢ –ë–æ–±–æ–≤—ã–µ: –≥–æ—Ä–æ—Ö, —Ñ–∞—Å–æ–ª—å, —á–µ—á–µ–≤–∏—Ü–∞
‚Ä¢ –ú–∞–∫–∞—Ä–æ–Ω—ã (–∏–∑ —Ç–≤–µ—Ä–¥—ã—Ö —Å–æ—Ä—Ç–æ–≤ –ø—à–µ–Ω–∏—Ü—ã)
‚Ä¢ –ö–æ–º–ø–æ—Ç—ã –∏–∑ —Å–≤–µ–∂–∏—Ö —Ñ—Ä—É–∫—Ç–æ–≤
‚Ä¢ –ß–∞–π, –∫–æ—Ñ–µ, —Ç—Ä–∞–≤—è–Ω—ã–µ –æ—Ç–≤–∞—Ä—ã

‚ùå <strong>–ó–∞–ø—Ä–µ—â–∞–µ—Ç—Å—è:</strong>
‚Ä¢ –†–∞—Å—Ç–∏—Ç–µ–ª—å–Ω–æ–µ –º–∞—Å–ª–æ –¥–ª—è –≥–æ—Ç–æ–≤–∫–∏
‚Ä¢ –ñ–∞—Ä–µ–Ω–∞—è –ø–∏—â–∞
‚Ä¢ –ü—Ä–æ–¥—É–∫—Ç—ã –∂–∏–≤–æ—Ç–Ω–æ–≥–æ –ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏—è
‚Ä¢ –°–ª–∏–≤–æ—á–Ω–æ–µ –º–∞—Å–ª–æ

üí° <strong>–†–µ—Ü–µ–ø—Ç:</strong> –û–≤–æ—â–Ω–æ–µ —Ä–∞–≥—É –±–µ–∑ –º–∞—Å–ª–∞ - —Ç—É—à–∏—Ç–µ –æ–≤–æ—â–∏ –≤ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–º —Å–æ–∫—É'''
        
        daily_info.spiritual_note = '–ì–æ—Ä—è—á–∞—è –ø–∏—â–∞ –±–µ–∑ –º–∞—Å–ª–∞. –í—Ä–µ–º—è —É–º–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –∏ –¥—É—Ö–æ–≤–Ω–æ–≥–æ —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–µ–Ω–∏—è.'
        daily_info.save()
        
        action = "–°–æ–∑–¥–∞–Ω–∞" if created else "–û–±–Ω–æ–≤–ª–µ–Ω–∞"
        print(f"‚úÖ {action} –∑–∞–ø–∏—Å—å –¥–ª—è 21 –∞–≤–≥—É—Å—Ç–∞")
        print(f"   –¢–∏–ø –ø–æ—Å—Ç–∞: {daily_info.get_fasting_type_display()}")
        print(f"   –û–ø–∏—Å–∞–Ω–∏–µ: {daily_info.fasting_description}")
        
        return True
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
        return False

def check_current_data():
    """–ü—Ä–æ–≤–µ—Ä–∏–º —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ"""
    print("\nüìä –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ:")
    
    for day in [20, 21, 22]:
        try:
            info = DailyOrthodoxInfo.objects.get(month=8, day=day)
            print(f"   {day}.08: {info.get_fasting_type_display()} - {info.fasting_description}")
        except DailyOrthodoxInfo.DoesNotExist:
            print(f"   {day}.08: –î–∞–Ω–Ω—ã—Ö –Ω–µ—Ç")

if __name__ == "__main__":
    print("üöÄ –ë—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è 21 –∞–≤–≥—É—Å—Ç–∞")
    print("=" * 50)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    check_current_data()
    
    # –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
    if fix_august_21():
        print("\n‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã!")
        print("üîÑ –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ –±—Ä–∞—É–∑–µ—Ä–µ")
    else:
        print("\n‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∏—Å–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    check_current_data()
