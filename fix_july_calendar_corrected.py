import os
import sys
import django

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Django
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'config.settings')
django.setup()

from pwa.models import OrthodoxEvent, DailyOrthodoxInfo
from datetime import date

print("üïäÔ∏è –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–æ—Å–ª–∞–≤–Ω–æ–≥–æ –∫–∞–ª–µ–Ω–¥–∞—Ä—è –¥–ª—è –∏—é–ª—è 2025")
print("=" * 60)

# =========================================================================
# –î–û–ë–ê–í–õ–Ø–ï–ú –ö–õ–Æ–ß–ï–í–´–ï –°–û–ë–´–¢–ò–Ø –ò–Æ–õ–Ø (–ë–ï–ó 2 –ò–Æ–õ–Ø - –û–ë–´–ß–ù–´–ô –ü–û–°–¢–ù–´–ô –î–ï–ù–¨)
# =========================================================================

july_events = [
    {
        'day': 7,
        'title': '–†–æ–∂–¥–µ—Å—Ç–≤–æ —á–µ—Å—Ç–Ω–æ–≥–æ —Å–ª–∞–≤–Ω–æ–≥–æ –ü—Ä–æ—Ä–æ–∫–∞, –ü—Ä–µ–¥—Ç–µ—á–∏ –∏ –ö—Ä–µ—Å—Ç–∏—Ç–µ–ª—è –ì–æ—Å–ø–æ–¥–Ω—è –ò–æ–∞–Ω–Ω–∞',
        'description': '–í–µ–ª–∏–∫–∏–π –ø—Ä–∞–∑–¥–Ω–∏–∫ –≤ —á–µ—Å—Ç—å —Ä–æ–∂–¥–µ–Ω–∏—è —Å–≤. –ò–æ–∞–Ω–Ω–∞ –ü—Ä–µ–¥—Ç–µ—á–∏, –∫–æ—Ç–æ—Ä—ã–π –±—ã–ª –ø—Ä–µ–¥—É–≥–æ—Ç–æ–≤–∞–Ω –ë–æ–≥–æ–º –±—ã—Ç—å –ü—Ä–µ–¥—Ç–µ—á–µ–π –ú–µ—Å—Å–∏–∏ –∏ –∫—Ä–µ—Å—Ç–∏—Ç—å –•—Ä–∏—Å—Ç–∞ –≤ –≤–æ–¥–∞—Ö –ò–æ—Ä–¥–∞–Ω–∞.',
        'event_type': 'great_feast',
        'gospel': '–õ–∫. 1:1-25, 57-68, 76, 80',
        'epistle': '–†–∏–º. 13:11 - 14:4',
        'fasting_type': 'no_fast',
        'fasting_desc': '–†–æ–∂–¥–µ—Å—Ç–≤–æ –ò–æ–∞–Ω–Ω–∞ –ü—Ä–µ–¥—Ç–µ—á–∏ (–≤–µ–ª–∏–∫–∏–π –ø—Ä–∞–∑–¥–Ω–∏–∫)',
        'spiritual_note': 'üéâ –†–æ–∂–¥–µ—Å—Ç–≤–æ —á–µ—Å—Ç–Ω–æ–≥–æ —Å–ª–∞–≤–Ω–æ–≥–æ –ü—Ä–æ—Ä–æ–∫–∞, –ü—Ä–µ–¥—Ç–µ—á–∏ –∏ –ö—Ä–µ—Å—Ç–∏—Ç–µ–ª—è –ì–æ—Å–ø–æ–¥–Ω—è –ò–æ–∞–Ω–Ω–∞! –í–µ–ª–∏–∫–∏–π –ø—Ä–∞–∑–¥–Ω–∏–∫ –≤ —á–µ—Å—Ç—å —Ä–æ–∂–¥–µ–Ω–∏—è —Å–≤—è—Ç–æ–≥–æ, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–≥–æ—Ç–æ–≤–∏–ª –ø—É—Ç—å –ì–æ—Å–ø–æ–¥—É.'
    },
    {
        'day': 12,
        'title': '–°–≤—è—Ç—ã—Ö –ø–µ—Ä–≤–æ–≤–µ—Ä—Ö–æ–≤–Ω—ã—Ö –∞–ø–æ—Å—Ç–æ–ª–æ–≤ –ü–µ—Ç—Ä–∞ –∏ –ü–∞–≤–ª–∞',
        'description': '–í–µ–ª–∏–∫–∏–π –ø—Ä–∞–∑–¥–Ω–∏–∫ –≤ —á–µ—Å—Ç—å —Å–≤—è—Ç—ã—Ö –∞–ø–æ—Å—Ç–æ–ª–æ–≤ –ü–µ—Ç—Ä–∞ –∏ –ü–∞–≤–ª–∞, —Å—Ç–æ–ª–ø–æ–≤ –¶–µ—Ä–∫–≤–∏ –•—Ä–∏—Å—Ç–æ–≤–æ–π.',
        'event_type': 'great_feast',
        'gospel': '–ú—Ñ. 16:13-19',
        'epistle': '2 –ö–æ—Ä. 11:21 - 12:9',
        'fasting_type': 'no_fast',
        'fasting_desc': '–ê–ø–æ—Å—Ç–æ–ª—ã –ü–µ—Ç—Ä –∏ –ü–∞–≤–µ–ª (–≤–µ–ª–∏–∫–∏–π –ø—Ä–∞–∑–¥–Ω–∏–∫)',
        'spiritual_note': '‚úùÔ∏è –°–≤—è—Ç—ã–µ –ø–µ—Ä–≤–æ–≤–µ—Ä—Ö–æ–≤–Ω—ã–µ –∞–ø–æ—Å—Ç–æ–ª—ã –ü–µ—Ç—Ä–∞ –∏ –ü–∞–≤–ª–∞! –í–µ–ª–∏–∫–∏–π –ø—Ä–∞–∑–¥–Ω–∏–∫ –≤ —á–µ—Å—Ç—å —Å—Ç–æ–ª–ø–æ–≤ –¶–µ—Ä–∫–≤–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–Ω–µ—Å–ª–∏ –≤–µ—Ä—É –•—Ä–∏—Å—Ç–æ–≤—É –ø–æ –≤—Å–µ–º—É –º–∏—Ä—É.'
    },
    {
        'day': 8,
        'title': '–í–µ–ª–∏–∫–æ–º—É—á–µ–Ω–∏–∫–∞ –ü—Ä–æ–∫–æ–ø–∏—è',
        'description': '–î–µ–Ω—å –ø–∞–º—è—Ç–∏ —Å–≤—è—Ç–æ–≥–æ –≤–µ–ª–∏–∫–æ–º—É—á–µ–Ω–∏–∫–∞ –ü—Ä–æ–∫–æ–ø–∏—è –ö–µ—Å–∞—Ä–∏–π—Å–∫–æ–≥–æ.',
        'event_type': 'minor_feast',
        'fasting_type': 'light_fast',  # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏
        'fasting_desc': '–û–±—ã—á–Ω—ã–π –¥–µ–Ω—å (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞–ª–µ–Ω–¥–∞—Ä—å –ø–æ—Å—Ç–æ–≤)',
        'spiritual_note': '‚öîÔ∏è –°–≤—è—Ç–æ–π –≤–µ–ª–∏–∫–æ–º—É—á–µ–Ω–∏–∫ –ü—Ä–æ–∫–æ–ø–∏–π. –ü–∞–º—è—Ç—å –≤–æ–∏–Ω–∞ –•—Ä–∏—Å—Ç–æ–≤–∞, –ø–æ—Å—Ç—Ä–∞–¥–∞–≤—à–µ–≥–æ –∑–∞ –≤–µ—Ä—É.'
    },
    {
        'day': 17,
        'title': '–°–≤—è—Ç–æ–π —Ü–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–π —Å—Ç—Ä–∞—Å—Ç–æ—Ç–µ—Ä–ø–∏—Ü—ã –≤–µ–ª–∏–∫–æ–π –∫–Ω—è–≥–∏–Ω–∏ –ï–ª–∏—Å–∞–≤–µ—Ç—ã –∏ –∏–Ω–æ–∫–∏–Ω–∏ –í–∞—Ä–≤–∞—Ä—ã',
        'description': '–î–µ–Ω—å –ø–∞–º—è—Ç–∏ —Å–≤—è—Ç—ã—Ö –Ω–æ–≤–æ–º—É—á–µ–Ω–∏—Ü —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö.',
        'event_type': 'minor_feast',
        'fasting_type': 'light_fast',
        'fasting_desc': '–û–±—ã—á–Ω—ã–π –¥–µ–Ω—å (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞–ª–µ–Ω–¥–∞—Ä—å –ø–æ—Å—Ç–æ–≤)', 
        'spiritual_note': 'üëë –°–≤—è—Ç—ã–µ —Ü–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å—Ç—Ä–∞—Å—Ç–æ—Ç–µ—Ä–ø–∏—Ü—ã. –ü–∞–º—è—Ç—å –æ –Ω–æ–≤–æ–º—É—á–µ–Ω–∏–∫–∞—Ö —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö, –ø–æ—Å—Ç—Ä–∞–¥–∞–≤—à–∏—Ö –∑–∞ –•—Ä–∏—Å—Ç–∞.'
    },
    {
        'day': 21,
        'title': '–Ø–≤–ª–µ–Ω–∏–µ –∏–∫–æ–Ω—ã –ü—Ä–µ—Å–≤—è—Ç–æ–π –ë–æ–≥–æ—Ä–æ–¥–∏—Ü—ã –≤–æ –≥—Ä–∞–¥–µ –ö–∞–∑–∞–Ω–∏',
        'description': '–í–µ–ª–∏–∫–∏–π –ø—Ä–∞–∑–¥–Ω–∏–∫ —è–≤–ª–µ–Ω–∏—è —á—É–¥–æ—Ç–≤–æ—Ä–Ω–æ–π –ö–∞–∑–∞–Ω—Å–∫–æ–π –∏–∫–æ–Ω—ã –ë–æ–∂–∏–µ–π –ú–∞—Ç–µ—Ä–∏.',
        'event_type': 'great_feast', 
        'gospel': '–õ–∫. 1:39-49, 56',
        'epistle': '–§–ª–ø. 2:5-11',
        'fasting_type': 'no_fast',
        'fasting_desc': '–ö–∞–∑–∞–Ω—Å–∫–∞—è –∏–∫–æ–Ω–∞ –ë–æ–∂–∏–µ–π –ú–∞—Ç–µ—Ä–∏ (–≤–µ–ª–∏–∫–∏–π –ø—Ä–∞–∑–¥–Ω–∏–∫)',
        'spiritual_note': 'üñºÔ∏è –Ø–≤–ª–µ–Ω–∏–µ –ö–∞–∑–∞–Ω—Å–∫–æ–π –∏–∫–æ–Ω—ã –ü—Ä–µ—Å–≤—è—Ç–æ–π –ë–æ–≥–æ—Ä–æ–¥–∏—Ü—ã! –í–µ–ª–∏–∫–∏–π –ø—Ä–∞–∑–¥–Ω–∏–∫ —á—É–¥–æ—Ç–≤–æ—Ä–Ω–æ–π –∏–∫–æ–Ω—ã, –∑–∞—Å—Ç—É–ø–Ω–∏—Ü—ã –∑–µ–º–ª–∏ –†—É—Å—Å–∫–æ–π.'
    },
    {
        'day': 28,
        'title': '–†–∞–≤–Ω–æ–∞–ø–æ—Å—Ç–æ–ª—å–Ω–æ–≥–æ –≤–µ–ª–∏–∫–æ–≥–æ –∫–Ω—è–∑—è –í–ª–∞–¥–∏–º–∏—Ä–∞, –≤–æ –°–≤—è—Ç–æ–º –ö—Ä–µ—â–µ–Ω–∏–∏ –í–∞—Å–∏–ª–∏—è',
        'description': '–î–µ–Ω—å –ø–∞–º—è—Ç–∏ —Å–≤—è—Ç–æ–≥–æ —Ä–∞–≤–Ω–æ–∞–ø–æ—Å—Ç–æ–ª—å–Ω–æ–≥–æ –∫–Ω—è–∑—è –í–ª–∞–¥–∏–º–∏—Ä–∞, –ö—Ä–µ—Å—Ç–∏—Ç–µ–ª—è –†—É—Å–∏.',
        'event_type': 'major_feast',
        'gospel': '–ò–Ω. 10:9-16',
        'epistle': '–ì–∞–ª. 5:22 - 6:2',
        'fasting_type': 'no_fast',
        'fasting_desc': '–†–∞–≤–Ω–æ–∞–ø–æ—Å—Ç–æ–ª—å–Ω—ã–π –∫–Ω—è–∑—å –í–ª–∞–¥–∏–º–∏—Ä (–±–æ–ª—å—à–æ–π –ø—Ä–∞–∑–¥–Ω–∏–∫)',
        'spiritual_note': 'üëë –°–≤—è—Ç–æ–π —Ä–∞–≤–Ω–æ–∞–ø–æ—Å—Ç–æ–ª—å–Ω—ã–π –∫–Ω—è–∑—å –í–ª–∞–¥–∏–º–∏—Ä! –ü–∞–º—è—Ç—å –ö—Ä–µ—Å—Ç–∏—Ç–µ–ª—è –†—É—Å–∏, –ø—Ä–æ—Å–≤–µ—Ç–∏–≤—à–µ–≥–æ –Ω–∞—à—É –∑–µ–º–ª—é —Å–≤–µ—Ç–æ–º –•—Ä–∏—Å—Ç–æ–≤—ã–º.'
    }
]

# –¢–∞–∫–∂–µ —É–¥–∞–ª—è–µ–º —Å–æ–±—ã—Ç–∏–µ 2 –∏—é–ª—è, –µ—Å–ª–∏ –æ–Ω–æ –±—ã–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ –æ—à–∏–±–∫–µ
print("üóëÔ∏è –£–¥–∞–ª—è–µ–º –ª–∏—à–Ω–µ–µ —Å–æ–±—ã—Ç–∏–µ 2 –∏—é–ª—è (–µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)...")
july_2_events = OrthodoxEvent.objects.filter(month=7, day=2)
if july_2_events.exists():
    deleted_count = july_2_events.delete()[0]
    print(f"   ‚úÖ –£–¥–∞–ª–µ–Ω–æ —Å–æ–±—ã—Ç–∏–π: {deleted_count}")
else:
    print("   ‚ÑπÔ∏è –°–æ–±—ã—Ç–∏—è –Ω–∞ 2 –∏—é–ª—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")

# –£–¥–∞–ª—è–µ–º –µ–∂–µ–¥–Ω–µ–≤–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è 2 –∏—é–ª—è
try:
    daily_info_2 = DailyOrthodoxInfo.objects.get(month=7, day=2)
    daily_info_2.delete()
    print("   ‚úÖ –£–¥–∞–ª–µ–Ω–∞ –µ–∂–µ–¥–Ω–µ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è 2 –∏—é–ª—è")
except DailyOrthodoxInfo.DoesNotExist:
    print("   ‚ÑπÔ∏è –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è 2 –∏—é–ª—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")

print()

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ –¥–æ–±–∞–≤–ª—è–µ–º —Å–æ–±—ã—Ç–∏—è
added_events = 0
updated_daily_info = 0

for event_data in july_events:
    day = event_data['day']
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å–æ–±—ã—Ç–∏–µ –≤ –±–∞–∑–µ
    existing_events = OrthodoxEvent.objects.filter(month=7, day=day, title__icontains=event_data['title'][:20])
    
    if not existing_events.exists():
        print(f"üìÖ –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–±—ã—Ç–∏–µ –Ω–∞ {day} –∏—é–ª—è...")
        
        event = OrthodoxEvent.objects.create(
            title=event_data['title'],
            description=event_data['description'],
            event_type=event_data['event_type'],
            month=7,
            day=day,
            is_old_style=False,
            is_movable=False
        )
        
        print(f"   ‚úÖ {event.title}")
        print(f"   ‚ú® –¢–∏–ø: {event.get_event_type_display()}")
        added_events += 1
    else:
        print(f"üìÖ –°–æ–±—ã—Ç–∏–µ –Ω–∞ {day} –∏—é–ª—è —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: {existing_events.first().title[:50]}...")
    
    # –î–æ–±–∞–≤–ª—è–µ–º/–æ–±–Ω–æ–≤–ª—è–µ–º –µ–∂–µ–¥–Ω–µ–≤–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–µ–ª–∏–∫–∏—Ö –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤
    if event_data['event_type'] in ['great_feast', 'major_feast']:
        try:
            daily_info = DailyOrthodoxInfo.objects.get(month=7, day=day)
            print(f"   üìñ –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —É–∂–µ –µ—Å—Ç—å")
        except DailyOrthodoxInfo.DoesNotExist:
            print(f"   üìñ –î–æ–±–∞–≤–ª—è–µ–º –µ–∂–µ–¥–Ω–µ–≤–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è {day} –∏—é–ª—è...")
            
            daily_info = DailyOrthodoxInfo.objects.create(
                month=7,
                day=day,
                fasting_type=event_data['fasting_type'],
                fasting_description=event_data['fasting_desc'],
                allowed_food='–õ—é–±–∞—è –ø–∏—â–∞ (–ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–π –¥–µ–Ω—å)' if event_data['fasting_type'] == 'no_fast' else '–†–∞—Å—Ç–∏—Ç–µ–ª—å–Ω–∞—è –ø–∏—â–∞',
                spiritual_note=event_data['spiritual_note'],
                gospel_reading=event_data.get('gospel', ''),
                epistle_reading=event_data.get('epistle', '')
            )
            
            print(f"   ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –µ–∂–µ–¥–Ω–µ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è")
            updated_daily_info += 1

print("\n" + "=" * 60)
print(f"üéâ –ó–ê–í–ï–†–®–ï–ù–û!")
print(f"üìÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –Ω–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π: {added_events}")
print(f"üìñ –î–æ–±–∞–≤–ª–µ–Ω–æ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏: {updated_daily_info}")

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ —Å–æ–±—ã—Ç–∏—è –∏—é–ª—è
print(f"\nüìä –í—Å–µ —Å–æ–±—ã—Ç–∏—è –∏—é–ª—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:")
july_events_db = OrthodoxEvent.objects.filter(month=7).order_by('day')
for event in july_events_db:
    print(f"   {event.day:2d} –∏—é–ª—è - {event.title[:60]}... ({event.get_event_type_display()})")

print(f"\nüìä –í—Å–µ–≥–æ —Å–æ–±—ã—Ç–∏–π –≤ –∏—é–ª–µ: {july_events_db.count()}")
print("\n‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–æ—Å–ª–∞–≤–Ω–æ–≥–æ –∫–∞–ª–µ–Ω–¥–∞—Ä—è –∑–∞–≤–µ—Ä—à–µ–Ω–æ!")
print("üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∫–∞–ª–µ–Ω–¥–∞—Ä—è, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è.")
print("‚ÑπÔ∏è  2 –∏—é–ª—è –æ—Å—Ç–∞–µ—Ç—Å—è –æ–±—ã—á–Ω—ã–º –ø–æ—Å—Ç–Ω—ã–º –¥–Ω–µ–º (—Å—Ä–µ–¥–∞) –±–µ–∑ –æ—Å–æ–±—ã—Ö —Å–æ–±—ã—Ç–∏–π.")
