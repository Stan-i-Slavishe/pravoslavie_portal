{% extends 'base.html' %}
{% load static %}

{% block title %}Заказ оплачен - {{ site_settings.site_name }}{% endblock %}

{% block extra_css %}
<style>
.success-container {
    max-width: 600px;
    margin: 0 auto;
    text-align: center;
}

.success-icon {
    width: 80px;
    height: 80px;
    background: #28a745;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 2rem;
    font-size: 2rem;
    color: white;
    animation: checkmark 0.6s ease-in-out;
}

@keyframes checkmark {
    0% {
        transform: scale(0);
    }
    50% {
        transform: scale(1.2);
    }
    100% {
        transform: scale(1);
    }
}

.order-details {
    background: #f8f9fa;
    border: 1px solid #e0e0e0;
    border-radius: 0.75rem;
    padding: 2rem;
    margin: 2rem 0;
    text-align: left;
}

.next-steps {
    background: #e3f2fd;
    border: 1px solid #bbdefb;
    border-radius: 0.75rem;
    padding: 1.5rem;
    margin: 2rem 0;
}

.order-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem 0;
    border-bottom: 1px solid #eee;
}

.order-item:last-child {
    border-bottom: none;
    font-weight: 600;
    border-top: 2px solid #dee2e6;
    padding-top: 1rem;
    margin-top: 1rem;
}

.download-btn {
    transition: all 0.3s ease;
}

.download-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
}
</style>
{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="success-container">
        <!-- Иконка успеха -->
        <div class="success-icon">
            <i class="bi bi-check"></i>
        </div>
        
        <h1 class="mb-3">Спасибо за покупку!</h1>
        <p class="lead mb-4">Ваш заказ успешно оплачен</p>
        
        <!-- Детали заказа -->
        <div class="order-details">
            <div class="row mb-3">
                <div class="col-sm-6">
                    <strong>Номер заказа:</strong><br>
                    #{{ order.short_id }}
                </div>
                <div class="col-sm-6">
                    <strong>Дата оплаты:</strong><br>
                    {{ order.paid_at|date:"d.m.Y H:i" }}
                </div>
            </div>
            
            <div class="row mb-3">
                <div class="col-sm-6">
                    <strong>Покупатель:</strong><br>
                    {{ order.full_name }}
                </div>
                <div class="col-sm-6">
                    <strong>Email:</strong><br>
                    {{ order.email }}
                </div>
            </div>
            
            <h6 class="mt-4 mb-3">Приобретенные товары:</h6>
            {% for item in order.items.all %}
                <div class="order-item">
                    <span>{{ item.product_title }} {% if item.quantity > 1 %}x{{ item.quantity }}{% endif %}</span>
                    <span>{{ item.total_price }}₽</span>
                </div>
            {% endfor %}
            
            <div class="order-item">
                <span>Итого оплачено:</span>
                <span class="text-success">{{ order.total_amount }}₽</span>
            </div>
        </div>
        
        <!-- Следующие шаги -->
        <div class="next-steps">
            <h5 class="mb-3">
                <i class="bi bi-info-circle me-2"></i>
                Что дальше?
            </h5>
            
            <div class="text-start">
                <div class="mb-2">
                    <i class="bi bi-envelope me-2 text-primary"></i>
                    Ссылки для скачивания отправлены на <strong>{{ order.email }}</strong>
                </div>
                <div class="mb-2">
                    <i class="bi bi-person me-2 text-primary"></i>
                    Все покупки доступны в вашем личном кабинете
                </div>
                <div class="mb-2">
                    <i class="bi bi-download me-2 text-primary"></i>
                    Скачивания доступны без ограничений по времени
                </div>
                <div>
                    <i class="bi bi-headset me-2 text-primary"></i>
                    При возникновении проблем обращайтесь в поддержку
                </div>
            </div>
        </div>
        
        <!-- Кнопки действий -->
        <div class="d-grid gap-2 d-md-block">
            <a href="{% url 'shop:my_purchases' %}" class="btn btn-success btn-lg download-btn">
                <i class="bi bi-download me-2"></i>
                Мои покупки
            </a>
            <a href="{% url 'shop:catalog' %}" class="btn btn-outline-primary btn-lg">
                <i class="bi bi-shop me-2"></i>
                Продолжить покупки
            </a>
        </div>
        
        <!-- Дополнительные ссылки -->
        <div class="mt-4">
            <div class="row text-center">
                <div class="col-md-4">
                    <a href="{% url 'shop:my_orders' %}" class="text-decoration-none">
                        <i class="bi bi-list-ul d-block mb-2" style="font-size: 1.5rem;"></i>
                        <small>Мои заказы</small>
                    </a>
                </div>
                <div class="col-md-4">
                    <a href="{% url 'core:contact' %}" class="text-decoration-none">
                        <i class="bi bi-headset d-block mb-2" style="font-size: 1.5rem;"></i>
                        <small>Поддержка</small>
                    </a>
                </div>
                <div class="col-md-4">
                    <a href="{% url 'books:list' %}" class="text-decoration-none">
                        <i class="bi bi-book d-block mb-2" style="font-size: 1.5rem;"></i>
                        <small>Библиотека</small>
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Благодарность -->
        <div class="mt-5 pt-4 border-top">
            <p class="text-muted">
                <i class="bi bi-heart-fill text-danger me-2"></i>
                Благодарим вас за поддержку православного портала!<br>
                Ваши покупки помогают нам создавать качественный духовный контент.
            </p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Конфетти эффект при загрузке страницы
    if (typeof confetti !== 'undefined') {
        confetti({
            particleCount: 100,
            spread: 70,
            origin: { y: 0.6 }
        });
    }
    
    // Автоматическое перенаправление через 30 секунд
    setTimeout(() => {
        const userChoice = confirm('Хотите перейти к своим покупкам?');
        if (userChoice) {
            window.location.href = '{% url "shop:my_purchases" %}';
        }
    }, 30000);
});
</script>
{% endblock %}
