<!-- –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –ú–û–ë–ò–õ–¨–ù–´–ô –í–ò–î–ñ–ï–¢ –ü–õ–ï–ô–õ–ò–°–¢–û–í –ë–ï–ó –°–ò–°–¢–ï–ú–ù–´–• –ü–õ–ï–ô–õ–ò–°–¢–û–í -->
{% if user.is_authenticated %}
<div class="mobile-playlist-widget d-lg-none mb-4" style="display: block !important;">
    <div class="card bg-light border-0 shadow-sm">
        <div class="card-body py-3">
            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –∫–Ω–æ–ø–∫–æ–π —Å–≤–µ—Ä–Ω—É—Ç—å/—Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å -->
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h6 class="mb-0 text-primary" style="font-size: 1.2rem; font-weight: 600;">
                    <i class="bi bi-music-note-list me-2" style="font-size: 1.3rem;"></i>
                    üì± –ú–æ–∏ –ø–ª–µ–π–ª–∏—Å—Ç—ã
                </h6>
                <div>
                    <button class="btn btn-sm btn-outline-primary me-2" 
                            data-bs-toggle="modal" 
                            data-bs-target="#playlistModal"
                            style="padding: 8px 12px;">
                        <i class="bi bi-plus" style="font-size: 1.1rem;"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-secondary" 
                            onclick="toggleMobilePlaylistContent()"
                            style="padding: 8px 12px;">
                        <i class="bi bi-chevron-down" id="mobilePlaylistToggleIcon" style="font-size: 1.1rem;"></i>
                    </button>
                </div>
            </div>
            
            <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤ (–∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–≤–µ—Ä–Ω—É—Ç) -->
            <div id="mobilePlaylistContent" style="display: none;">
                <div id="mobilePlaylistContainer">
                    <!-- –ó–¥–µ—Å—å –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –ø–ª–µ–π–ª–∏—Å—Ç—ã —á–µ—Ä–µ–∑ JavaScript -->
                    <div class="text-center py-3">
                        <div class="spinner-border spinner-border-sm text-primary" role="status">
                            <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                        </div>
                        <p class="mt-2 text-muted small">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% else %}
<!-- –î–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö -->
<div class="mobile-playlist-widget d-lg-none mb-4" style="display: block !important;">
    <div class="card bg-light border-0 shadow-sm">
        <div class="card-body py-3 text-center">
            <div class="d-flex align-items-center justify-content-center">
                <i class="bi bi-music-note-list text-muted me-2"></i>
                <span class="text-muted small">
                    <a href="{% url 'account_login' %}" class="text-decoration-none">–í–æ–π–¥–∏—Ç–µ</a> 
                    –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤
                </span>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –ø–ª–µ–π–ª–∏—Å—Ç–∞ (–º–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è) -->
<div class="modal fade" id="mobilePlaylistContentModal" tabindex="-1" aria-labelledby="mobilePlaylistContentModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="mobilePlaylistContentModalLabel">
                    <i class="bi bi-music-note-list me-2"></i>
                    <span id="modalPlaylistTitle">–ü–ª–µ–π–ª–∏—Å—Ç</span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="modalPlaylistContent">
                    <!-- –ó–¥–µ—Å—å –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–ª–µ–π–ª–∏—Å—Ç–∞ -->
                    <div class="text-center py-4">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                        </div>
                        <p class="mt-3 text-muted">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –ø–ª–µ–π–ª–∏—Å—Ç–∞...</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="bi bi-x"></i>
                    –ó–∞–∫—Ä—ã—Ç—å
                </button>
                <button type="button" class="btn btn-primary" onclick="editCurrentPlaylist()">
                    <i class="bi bi-pencil"></i>
                    –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                </button>
            </div>
        </div>
    </div>
</div>

<!-- CSS —Å—Ç–∏–ª–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –≤–∏–¥–∂–µ—Ç–∞ –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤ -->
<style>
/* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
@media (max-width: 991.98px) {
    .mobile-playlist-widget {
        display: block !important;
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border-radius: 15px;
        margin-bottom: 1.5rem;
    }
}

/* –°–∫—Ä—ã–≤–∞–µ–º –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ */
@media (min-width: 992px) {
    .mobile-playlist-widget {
        display: none !important;
    }
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –≤–∏–¥–∂–µ—Ç–∞ –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤ */
.mobile-playlist-widget .card {
    border-radius: 15px;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
}

.mobile-playlist-widget .playlist-item {
    background: white;
    border-radius: 10px;
    padding: 16px;
    margin-bottom: 12px;
    border: 1px solid #e3e6ea;
    transition: all 0.2s ease;
    min-height: 60px;
}

.mobile-playlist-widget .playlist-item:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    background: #f8f9fa;
}

.mobile-playlist-widget .playlist-title {
    font-weight: 600;
    color: #495057;
    font-size: 1.1rem;
    line-height: 1.4;
    margin-bottom: 4px;
}

.mobile-playlist-widget .story-count {
    color: #6c757d;
    font-size: 0.9rem;
}

.mobile-playlist-widget .playlist-date {
    color: #adb5bd;
    font-size: 0.85rem;
}

.mobile-playlist-widget .play-icon {
    color: #007bff !important;
    font-size: 1.4rem;
}

.mobile-playlist-widget .btn {
    padding: 10px 16px;
    font-size: 0.95rem;
}

.mobile-playlist-widget .btn-sm {
    padding: 8px 12px;
    font-size: 0.9rem;
}

.mobile-playlist-widget .btn i {
    font-size: 1.1rem;
}

.mobile-playlist-widget .bi-chevron-right {
    font-size: 1.2rem;
    color: #007bff !important;
}

#mobilePlaylistToggleIcon {
    transition: transform 0.3s ease;
}

#mobilePlaylistToggleIcon.rotated {
    transform: rotate(180deg);
}

#mobilePlaylistContent {
    overflow: hidden;
    transition: all 0.3s ease;
}

#mobilePlaylistContent.show {
    display: block !important;
}
</style>

<script>
// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –º–æ–±–∏–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤
function toggleMobilePlaylistContent() {
    const content = document.getElementById('mobilePlaylistContent');
    const icon = document.getElementById('mobilePlaylistToggleIcon');
    
    if (content.style.display === 'none' || content.style.display === '') {
        content.style.display = 'block';
        icon.classList.add('rotated');
        icon.classList.remove('bi-chevron-down');
        icon.classList.add('bi-chevron-up');
        
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ –∂–µ –¥–∞–Ω–Ω—ã–µ, —á—Ç–æ –∏ –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞
        if (typeof userPlaylists !== 'undefined' && userPlaylists.length > 0) {
            updateMobilePlaylistUI(userPlaylists);
        } else {
            loadMobileUserPlaylists();
        }
    } else {
        content.style.display = 'none';
        icon.classList.remove('rotated');
        icon.classList.remove('bi-chevron-up');
        icon.classList.add('bi-chevron-down');
    }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤ –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏ (–¢–û–õ–¨–ö–û –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ)
function loadMobileUserPlaylists() {
    console.log('üì± –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–±–∏–ª—å–Ω—ã—Ö –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤...');
    
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤
    if (typeof userPlaylists !== 'undefined') {
        updateMobilePlaylistUI(userPlaylists);
    } else {
        // –ó–∞–ø–∞—Å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–¢–û–õ–¨–ö–û –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –ø–ª–µ–π–ª–∏—Å—Ç—ã, –ë–ï–ó —Å–∏—Å—Ç–µ–º–Ω—ã—Ö)
        const fallbackPlaylists = [
            { id: 1, title: '–ö–ª–æ–Ω–¥–∞–π–∫', stories_count: 1, created_at: '09.07.2025', is_private: true },
            { id: 2, title: '–ö–∞–∫–∞ —Ç–µ—Å—Ç–∞', stories_count: 1, created_at: '09.07.2025', is_private: true },
            { id: 4, title: '–ü—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–µ –∏—Å—Ç–æ—Ä–∏–∏', stories_count: 0, created_at: '09.07.2025', is_private: false }
        ];
        updateMobilePlaylistUI(fallbackPlaylists);
    }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–±–∏–ª—å–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤ (–¢–û–õ–¨–ö–û –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ)
function updateMobilePlaylistUI(playlists) {
    const mobilePlaylistContainer = document.getElementById('mobilePlaylistContainer');
    if (!mobilePlaylistContainer) {
        console.log('‚ö†Ô∏è  –ú–æ–±–∏–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω');
        return;
    }
    
    let playlistHTML = '';
    
    if (playlists.length > 0) {
        playlists.forEach(playlist => {
            playlistHTML += `
                <div class="playlist-item" onclick="openMobilePlaylistModal(${playlist.id}, '${playlist.title}')" style="cursor: pointer;">
                    <div class="d-flex align-items-center">
                        <i class="bi bi-play-circle play-icon me-2"></i>
                        <div class="flex-grow-1">
                            <div class="playlist-title">${playlist.title}</div>
                            <div class="d-flex justify-content-between align-items-center mt-1">
                                <small class="story-count">${playlist.stories_count} —Ä–∞—Å—Å–∫–∞–∑–æ–≤</small>
                                <small class="playlist-date">
                                    <i class="bi bi-${playlist.is_private ? 'lock' : 'globe'} me-1"></i>
                                    ${playlist.is_private ? '–ü—Ä–∏–≤–∞—Ç–Ω—ã–π' : '–ü—É–±–ª–∏—á–Ω—ã–π'}
                                </small>
                            </div>
                        </div>
                        <div class="playlist-actions ms-2">
                            <i class="bi bi-chevron-right text-muted"></i>
                        </div>
                    </div>
                </div>
            `;
        });
    } else {
        playlistHTML = `
            <div class="text-center text-muted py-3">
                <i class="bi bi-music-note-list fs-5 d-block mb-2"></i>
                <small>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤</small>
                <br>
                <small class="text-primary">–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–π –ø–µ—Ä–≤—ã–π!</small>
            </div>
        `;
    }
    
    mobilePlaylistContainer.innerHTML = playlistHTML;
}

// –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–ª–µ–π–ª–∏—Å—Ç–∞ –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –≤–∏–¥–∂–µ—Ç–∞
function openMobilePlaylistModal(playlistId, playlistTitle) {
    console.log(`üì± –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–ª–µ–π–ª–∏—Å—Ç–∞: ${playlistTitle} (ID: ${playlistId})`);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    document.getElementById('modalPlaylistTitle').textContent = playlistTitle;
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
    const modal = new bootstrap.Modal(document.getElementById('mobilePlaylistContentModal'));
    modal.show();
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–ª–µ–π–ª–∏—Å—Ç–∞
    loadPlaylistContent(playlistId);
}

// –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –ø–ª–µ–π–ª–∏—Å—Ç–∞
function loadPlaylistContent(playlistId) {
    const modalContent = document.getElementById('modalPlaylistContent');
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
    setTimeout(() => {
        modalContent.innerHTML = `
            <div class="list-group list-group-flush">
                <div class="list-group-item d-flex align-items-center">
                    <img src="https://img.youtube.com/vi/dQw4w9WgXcQ/mqdefault.jpg" 
                         class="rounded me-3" 
                         style="width: 80px; height: 60px; object-fit: cover;" 
                         alt="–ú–∏–Ω–∏–∞—Ç—é—Ä–∞">
                    <div class="flex-grow-1">
                        <h6 class="mb-1">–ü—Ä–∏–º–µ—Ä —Ä–∞—Å—Å–∫–∞–∑–∞ 1</h6>
                        <small class="text-muted">
                            <i class="bi bi-eye me-1"></i>3 –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
                            <i class="bi bi-calendar3 ms-2 me-1"></i>03.07.2025
                        </small>
                    </div>
                    <div class="ms-2">
                        <button class="btn btn-sm btn-outline-danger" onclick="removeFromPlaylist(${playlistId}, 1)">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </div>
                
                <div class="list-group-item d-flex align-items-center">
                    <img src="https://img.youtube.com/vi/dQw4w9WgXcQ/mqdefault.jpg" 
                         class="rounded me-3" 
                         style="width: 80px; height: 60px; object-fit: cover;" 
                         alt="–ú–∏–Ω–∏–∞—Ç—é—Ä–∞">
                    <div class="flex-grow-1">
                        <h6 class="mb-1">–ü—Ä–∏–º–µ—Ä —Ä–∞—Å—Å–∫–∞–∑–∞ 2</h6>
                        <small class="text-muted">
                            <i class="bi bi-eye me-1"></i>1 –ø—Ä–æ—Å–º–æ—Ç—Ä
                            <i class="bi bi-calendar3 ms-2 me-1"></i>03.07.2025
                        </small>
                    </div>
                    <div class="ms-2">
                        <button class="btn btn-sm btn-outline-danger" onclick="removeFromPlaylist(${playlistId}, 2)">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </div>
                
                <div class="text-center py-3 text-muted">
                    <i class="bi bi-info-circle me-1"></i>
                    –í—Å–µ–≥–æ –≤ –ø–ª–µ–π–ª–∏—Å—Ç–µ: 2 —Ä–∞—Å—Å–∫–∞–∑–∞
                </div>
            </div>
        `;
    }, 800);
}

// –£–¥–∞–ª–µ–Ω–∏–µ —Ä–∞—Å—Å–∫–∞–∑–∞ –∏–∑ –ø–ª–µ–π–ª–∏—Å—Ç–∞
function removeFromPlaylist(playlistId, storyId) {
    console.log(`üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ —Ä–∞—Å—Å–∫–∞–∑–∞ ${storyId} –∏–∑ –ø–ª–µ–π–ª–∏—Å—Ç–∞ ${playlistId}`);
    
    if (confirm('–£–¥–∞–ª–∏—Ç—å —Ä–∞—Å—Å–∫–∞–∑ –∏–∑ –ø–ª–µ–π–ª–∏—Å—Ç–∞?')) {
        // TODO: –†–µ–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ API
        showToast('–†–∞—Å—Å–∫–∞–∑ —É–¥–∞–ª–µ–Ω –∏–∑ –ø–ª–µ–π–ª–∏—Å—Ç–∞', 'success');
        
        // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–ª–µ–π–ª–∏—Å—Ç–∞
        setTimeout(() => {
            loadPlaylistContent(playlistId);
        }, 500);
    }
}

// –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–ª–µ–π–ª–∏—Å—Ç–∞
function editCurrentPlaylist() {
    console.log('‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–ª–µ–π–ª–∏—Å—Ç–∞');
    showToast('–§—É–Ω–∫—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–∑–∂–µ', 'info');
    
    // TODO: –õ–æ–≥–∏–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–ª–µ–π–ª–∏—Å—Ç–∞
}

// –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (Toast)
function showToast(message, type = 'info') {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ñ—É–Ω–∫—Ü–∏—è showToast –≥–ª–æ–±–∞–ª—å–Ω–æ
    if (typeof window.showToast === 'function') {
        window.showToast(message, type);
    } else {
        // –ü—Ä–æ—Å—Ç–æ–µ alert –µ—Å–ª–∏ Toast –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω
        alert(message);
    }
}

console.log('üì± –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –º–æ–±–∏–ª—å–Ω—ã–π –≤–∏–¥–∂–µ—Ç –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤ –∑–∞–≥—Ä—É–∂–µ–Ω (–ë–ï–ó —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤)');
</script>