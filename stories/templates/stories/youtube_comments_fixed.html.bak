<!-- –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –°–ò–°–¢–ï–ú–ê –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ï–í -->
<div class="youtube-comments mt-4">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ -->
    <div class="comments-header mb-4">
        <h4 class="d-flex align-items-center">
            <i class="fas fa-comments me-2 text-primary"></i>
            <span id="total-comments-count">{{ comments.count }}</span>
            <span id="comments-word-label" class="ms-1">
                {% if comments.count == 1 %}
                    –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
                {% elif comments.count >= 2 and comments.count <= 4 %}
                    –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
                {% else %}
                    –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
                {% endif %}
            </span>
        </h4>
    </div>
    
    <!-- –ì–ª–∞–≤–Ω–∞—è —Ñ–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è -->
    {% if user.is_authenticated %}
    <div class="add-comment-section mb-4">
        <div class="d-flex align-items-start">
            <div class="user-avatar me-3">
                <div class="avatar-circle bg-primary text-white">
                    {% if user.first_name %}{{ user.first_name|first|upper }}{{ user.last_name|first|upper }}{% else %}{{ user.username|first|upper }}{% endif %}
                </div>
            </div>
            <div class="flex-grow-1">
                <form id="main-comment-form" method="post">
                    {% csrf_token %}
                    <textarea id="main-comment-textarea" 
                              name="text" 
                              class="form-control mb-2" 
                              rows="1" 
                              placeholder="–î–æ–±–∞–≤—å—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." 
                              required 
                              maxlength="2000"></textarea>
                    
                    <!-- üìä –°–ß–ï–¢–ß–ò–ö –°–†–ê–ó–£ –ü–û–î –¢–ï–ö–°–¢–û–í–´–ú –ü–û–õ–ï–ú -->
                    <div class="char-counter-container text-end" id="char-counter-container" style="display: none;">
                        <small class="text-muted char-counter">
                            <span id="main-char-count">0</span>/2000 —Å–∏–º–≤–æ–ª–æ–≤
                        </small>
                    </div>
                    
                    <!-- –î–µ–π—Å—Ç–≤–∏—è —Ñ–æ—Ä–º—ã (—Å–∫—Ä—ã—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
                    <div id="main-comment-actions" style="display: none;">
                        <div class="action-buttons d-flex align-items-center justify-content-end">
                            <button type="button" class="btn btn-sm btn-secondary me-2" onclick="cancelMainComment()">
                                –û—Ç–º–µ–Ω–∞
                            </button>
                            <button type="submit" class="btn btn-sm btn-primary submit-btn" disabled>
                                <i class="fas fa-paper-plane me-1"></i>–ö–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    {% else %}
    <div class="auth-prompt mb-4 p-3 bg-light rounded text-center">
        <p class="mb-2"><strong>–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</strong></p>
        <a href="{% url 'account_login' %}?next={{ request.get_full_path }}" class="btn btn-primary me-2">–í–æ–π—Ç–∏</a>
        <a href="{% url 'account_signup' %}?next={{ request.get_full_path }}" class="btn btn-outline-primary">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
    </div>
    {% endif %}
    
    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div id="comments-loading" style="display: none;">
        <div class="text-center py-4">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
            </div>
            <p class="mt-2 text-muted">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤...</p>
        </div>
    </div>
    
    <!-- –°–æ–æ–±—â–µ–Ω–∏–µ "–Ω–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤" -->
    <div id="no-comments" style="display: {% if comments %}none{% else %}block{% endif %};">
        <div class="no-comments text-center py-5">
            <i class="far fa-comment-dots text-muted mb-3" style="font-size: 4rem;"></i>
            <h5 class="text-muted mb-2">–ü–æ–∫–∞ –Ω–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤</h5>
            <p class="text-muted mb-3">–°—Ç–∞–Ω—å—Ç–µ –ø–µ—Ä–≤—ã–º, –∫—Ç–æ –ø–æ–¥–µ–ª–∏—Ç—Å—è –º–Ω–µ–Ω–∏–µ–º!</p>
            {% if user.is_authenticated %}
            <button class="btn btn-primary" onclick="focusMainComment()">
                <i class="fas fa-comment me-2"></i>–ù–∞–ø–∏—Å–∞—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
            </button>
            {% endif %}
        </div>
    </div>
    
    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ -->
    <div id="comments-container" class="comments-list" style="display: {% if comments %}block{% else %}none{% endif %};">
        {% for comment in comments %}
        <div class="comment-item mb-4" id="comment-{{ comment.id }}" data-comment-id="{{ comment.id }}">
            <!-- –û–°–ù–û–í–ù–û–ô –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ô -->
            <div class="main-comment">
                <div class="d-flex align-items-start">
                    <!-- –ê–≤–∞—Ç–∞—Ä -->
                    <div class="comment-avatar me-3">
                        <div class="avatar-circle bg-secondary text-white">
                            {% if comment.user.first_name %}{{ comment.user.first_name|first|upper }}{{ comment.user.last_name|first|upper }}{% else %}{{ comment.user.username|first|upper }}{% endif %}
                        </div>
                    </div>
                    
                    <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è -->
                    <div class="comment-content flex-grow-1">
                        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è -->
                        <div class="comment-header d-flex justify-content-between align-items-center mb-1">
                            <div class="comment-meta">
                                <strong class="comment-author">{{ comment.user.get_full_name|default:comment.user.username }}</strong>
                                <span class="comment-time text-muted ms-2">{{ comment.get_time_since_posted }}</span>
                            </div>
                            {% if user == comment.user or user.is_staff %}
                            <div class="comment-actions">
                                <button class="btn btn-sm btn-outline-danger ajax-delete-comment" 
                                        data-comment-id="{{ comment.id }}"
                                        data-comment-type="comment"
                                        title="–£–¥–∞–ª–∏—Ç—å">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                            {% endif %}
                        </div>
                        
                        <!-- –¢–µ–∫—Å—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è -->
                        <div class="comment-text mb-2">
                            <p class="mb-0">{{ comment.text|linebreaks }}</p>
                        </div>
                        
                        <!-- –î–µ–π—Å—Ç–≤–∏—è —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–º -->
                        {% if user.is_authenticated %}
                        <div class="comment-reactions mb-2">
                            <div class="d-flex align-items-center gap-2">
                                <!-- –õ–∞–π–∫–∏/–¥–∏–∑–ª–∞–π–∫–∏ AJAX –≤–µ—Ä—Å–∏—è -->
                                <button class="btn btn-sm btn-outline-success ajax-reaction-btn like-btn" 
                                        data-comment-id="{{ comment.id }}" 
                                        data-reaction="like">
                                    <i class="fas fa-thumbs-up me-1"></i>
                                    <span class="likes-count">{{ comment.likes_count }}</span>
                                </button>
                                <button class="btn btn-sm btn-outline-danger ajax-reaction-btn dislike-btn" 
                                        data-comment-id="{{ comment.id }}" 
                                        data-reaction="dislike">
                                    <i class="fas fa-thumbs-down me-1"></i>
                                    <span class="dislikes-count">{{ comment.dislikes_count }}</span>
                                </button>
                                
                                <!-- –ö–ù–û–ü–ö–ê –û–¢–í–ï–¢–ò–¢–¨ (AJAX –≤–µ—Ä—Å–∏—è) -->
                                <button class="btn btn-sm btn-outline-primary ajax-reply-btn" 
                                data-comment-id="{{ comment.id }}"
                                    data-author="{{ comment.user.get_full_name|default:comment.user.username }}">
                                    <i class="fas fa-reply me-1"></i>–û—Ç–≤–µ—Ç–∏—Ç—å
                        </button>
                            </div>
                        </div>
                        
                        <!-- –§–û–†–ú–ê –û–¢–í–ï–¢–ê (AJAX –≤–µ—Ä—Å–∏—è) -->
                        <div class="ajax-reply-form-container" id="ajax-reply-form-{{ comment.id }}" style="display: none;">
                            <!-- –§–æ—Ä–º–∞ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ JavaScript -->
                        </div>
                        {% endif %}
                        
                        <!-- –û–¢–í–ï–¢–´ –ù–ê –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ô -->
                        <div class="replies-container" id="replies-{{ comment.id }}">
                            {% if comment.replies.all %}
                            <!-- –ö–Ω–æ–ø–∫–∞ –ø–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –æ—Ç–≤–µ—Ç—ã (–∫–∞–∫ –≤ YouTube) -->
                            <div class="replies-toggle-section mt-2 mb-2">
                                <button class="btn btn-link p-0 text-primary replies-toggle-btn" 
                                        onclick="toggleRepliesVisibility('{{ comment.id }}')" 
                                        data-comment-id="{{ comment.id }}"
                                        data-replies-count="{{ comment.replies_count }}">
                                    <i class="fas fa-chevron-down me-1 toggle-icon"></i>
                                    <span class="toggle-text">–ü–æ–∫–∞–∑–∞—Ç—å {{ comment.replies_count }} 
                                    {% if comment.replies_count == 1 %}–æ—Ç–≤–µ—Ç{% elif comment.replies_count < 5 %}–æ—Ç–≤–µ—Ç–∞{% else %}–æ—Ç–≤–µ—Ç–æ–≤{% endif %}</span>
                                </button>
                            </div>
                            
                            <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –æ—Ç–≤–µ—Ç–∞–º–∏ (—Å–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
                            <div class="replies-section mt-3" id="replies-content-{{ comment.id }}" style="display: none;">
                            <div class="replies-wrapper ps-4 curved-reply-border">
                                    {% for reply in comment.replies.all %}
                                    <div class="reply-item mb-3 animate-fade-in" data-comment-id="{{ reply.id }}">
                                        <div class="d-flex align-items-start">
                                            <!-- –ê–≤–∞—Ç–∞—Ä –æ—Ç–≤–µ—Ç–∏–≤—à–µ–≥–æ -->
                                            <div class="reply-avatar me-2">
                                                <div class="avatar-circle-small bg-info text-white">
                                                    {% if reply.user.first_name %}{{ reply.user.first_name|first|upper }}{{ reply.user.last_name|first|upper }}{% else %}{{ reply.user.username|first|upper }}{% endif %}
                                                </div>
                                            </div>
                                            
                                            <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –æ—Ç–≤–µ—Ç–∞ -->
                                            <div class="reply-content flex-grow-1">
                                                <div class="reply-header d-flex justify-content-between align-items-center mb-1">
                                                    <div class="reply-meta">
                                                        <strong class="reply-author">{{ reply.user.get_full_name|default:reply.user.username }}</strong>
                                                        <span class="reply-time text-muted ms-2">{{ reply.get_time_since_posted }}</span>
                                                    </div>
                                                    {% if user == reply.user or user.is_staff %}
                                                    <button class="btn btn-sm btn-outline-danger ajax-delete-comment" 
                                                            data-comment-id="{{ reply.id }}"
                                                            data-comment-type="reply"
                                                            title="–£–¥–∞–ª–∏—Ç—å">
                                                        <i class="fas fa-times"></i>
                                                    </button>
                                                    {% endif %}
                                                </div>
                                                <div class="reply-text">
                                                    <p class="mb-1 small">{{ reply.text|linebreaks }}</p>
                                                </div>
                                                
                                                <!-- –õ–∞–π–∫–∏ –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤ AJAX –≤–µ—Ä—Å–∏—è -->
                                                {% if user.is_authenticated %}
                                                <div class="reply-reactions mt-1">
                                                    <button class="btn btn-sm btn-outline-success me-1 ajax-reaction-btn like-btn" 
                                                            data-comment-id="{{ reply.id }}" 
                                                            data-reaction="like">
                                                        <i class="fas fa-thumbs-up"></i> 
                                                        <span class="likes-count">{{ reply.likes_count }}</span>
                                                    </button>
                                                    <button class="btn btn-sm btn-outline-danger ajax-reaction-btn dislike-btn" 
                                                            data-comment-id="{{ reply.id }}" 
                                                            data-reaction="dislike">
                                                        <i class="fas fa-thumbs-down"></i> 
                                                        <span class="dislikes-count">{{ reply.dislikes_count }}</span>
                                                    </button>
                                                </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- –¢–û–õ–¨–ö–û AJAX JAVASCRIPT + UI –õ–û–ì–ò–ö–ê -->
<script>
// –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è AJAX —Å–∏—Å—Ç–µ–º—ã
window.STORY_SLUG = '{{ story.slug }}';
window.CSRF_TOKEN = '{{ csrf_token }}';

// UI –õ–û–ì–ò–ö–ê –î–õ–Ø –û–°–ù–û–í–ù–û–ô –§–û–†–ú–´ (–±–µ–∑ –æ—Ç–ø—Ä–∞–≤–∫–∏)
document.addEventListener('DOMContentLoaded', function() {
    console.log('‚úÖ UI —Å–∏—Å—Ç–µ–º–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
    setupMainCommentFormUI();
});

function setupMainCommentFormUI() {
    const textarea = document.getElementById('main-comment-textarea');
    const actions = document.getElementById('main-comment-actions');
    const charCounterContainer = document.getElementById('char-counter-container');
    const form = document.getElementById('main-comment-form');
    const submitBtn = form?.querySelector('.submit-btn');
    const charCount = document.getElementById('main-char-count');
    
    if (!textarea || !actions || !form) return;
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ–∫—É—Å–∞ - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–Ω–æ–ø–∫–∏ –ò —Å—á–µ—Ç—á–∏–∫
    textarea.addEventListener('focus', () => {
        textarea.classList.add('expanded');
        actions.style.display = 'block';
        
        // üìä –ü–û–ö–ê–ó–ê–¢–¨ –°–ß–ï–¢–ß–ò–ö –ü–û–î –¢–ï–ö–°–¢–û–í–´–ú –ü–û–õ–ï–ú
        if (charCounterContainer) {
            charCounterContainer.style.display = 'block';
        }
        
        textarea.rows = 3;
    });
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–≤–æ–¥–∞ - —Å—á–µ—Ç—á–∏–∫ —Å–∏–º–≤–æ–ª–æ–≤ –∏ –∞–∫—Ç–∏–≤–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏
    textarea.addEventListener('input', () => {
        const current = textarea.value.length;
        charCount.textContent = current; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
        
        // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞ —Å—á–µ—Ç—á–∏–∫–∞
        const counter = charCount.parentElement;
        counter.className = 'text-muted char-counter small';
        if (current > 1800) counter.classList.add('text-warning'); // –ñ–µ–ª—Ç—ã–π –ø—Ä–∏ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–∏ –∫ –ª–∏–º–∏—Ç—É
        if (current > 1950) counter.classList.add('text-danger'); // –ö—Ä–∞—Å–Ω—ã–π –ø—Ä–∏ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–∏ –∫ –º–∞–∫—Å–∏–º—É–º—É
        
        // –ê–∫—Ç–∏–≤–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏
        if (submitBtn) {
            submitBtn.disabled = textarea.value.trim().length === 0;
        }
    });
    
    // ‚úÖ –ù–ï –ü–ï–†–ï–•–í–ê–¢–´–í–ê–ï–ú SUBMIT - —ç—Ç–æ –¥–µ–ª–∞–µ—Ç AJAX —Å–∏—Å—Ç–µ–º–∞!
    // Ctrl+Enter –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ (–±—É–¥–µ—Ç –ø–µ—Ä–µ—Ö–≤–∞—á–µ–Ω–æ AJAX —Å–∏—Å—Ç–µ–º–æ–π)
    textarea.addEventListener('keydown', (e) => {
        if (e.ctrlKey && e.key === 'Enter' && !submitBtn.disabled) {
            e.preventDefault();
            form.dispatchEvent(new Event('submit', { bubbles: true }));
        }
    });
}

// –ù–û–í–û–ï: –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞/—Å–∫—Ä—ã—Ç–∏—è –æ—Ç–≤–µ—Ç–æ–≤ (–∫–∞–∫ –≤ YouTube)
function toggleRepliesVisibility(commentId) {
    const repliesContent = document.getElementById(`replies-content-${commentId}`);
    const toggleButton = document.querySelector(`[data-comment-id="${commentId}"].replies-toggle-btn`);
    const toggleIcon = toggleButton.querySelector('.toggle-icon');
    const toggleText = toggleButton.querySelector('.toggle-text');
    const repliesCount = toggleButton.dataset.repliesCount;
    
    if (!repliesContent || !toggleButton) return;
    
    const isHidden = repliesContent.style.display === 'none';
    
    if (isHidden) {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Ç–≤–µ—Ç—ã
        repliesContent.style.display = 'block';
        
        // –ú–µ–Ω—è–µ–º –∏–∫–æ–Ω–∫—É –∏ —Ç–µ–∫—Å—Ç
        toggleIcon.className = 'fas fa-chevron-up me-1 toggle-icon';
        
        let replyText = '–æ—Ç–≤–µ—Ç–æ–≤';
        if (repliesCount == 1) {
            replyText = '–æ—Ç–≤–µ—Ç';
        } else if (repliesCount < 5) {
            replyText = '–æ—Ç–≤–µ—Ç–∞';
        }
        
        toggleText.textContent = `–°–∫—Ä—ã—Ç—å ${repliesCount} ${replyText}`;
        
        // –ü–ª–∞–≤–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è
        repliesContent.style.opacity = '0';
        repliesContent.style.transform = 'translateY(-10px)';
        
        setTimeout(() => {
            repliesContent.style.transition = 'all 0.3s ease';
            repliesContent.style.opacity = '1';
            repliesContent.style.transform = 'translateY(0)';
        }, 10);
        
    } else {
        // –°–∫—Ä—ã–≤–∞–µ–º –æ—Ç–≤–µ—Ç—ã
        repliesContent.style.transition = 'all 0.2s ease';
        repliesContent.style.opacity = '0';
        repliesContent.style.transform = 'translateY(-10px)';
        
        setTimeout(() => {
            repliesContent.style.display = 'none';
            repliesContent.style.transition = '';
        }, 200);
        
        // –ú–µ–Ω—è–µ–º –∏–∫–æ–Ω–∫—É –∏ —Ç–µ–∫—Å—Ç
        toggleIcon.className = 'fas fa-chevron-down me-1 toggle-icon';
        
        let replyText = '–æ—Ç–≤–µ—Ç–æ–≤';
        if (repliesCount == 1) {
            replyText = '–æ—Ç–≤–µ—Ç';
        } else if (repliesCount < 5) {
            replyText = '–æ—Ç–≤–µ—Ç–∞';
        }
        
        toggleText.textContent = `–ü–æ–∫–∞–∑–∞—Ç—å ${repliesCount} ${replyText}`;
    }
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
function focusMainComment() {
    const textarea = document.getElementById('main-comment-textarea');
    if (textarea) {
        textarea.focus();
    }
}

function cancelMainComment() {
    const textarea = document.getElementById('main-comment-textarea');
    const actions = document.getElementById('main-comment-actions');
    const charCounterContainer = document.getElementById('char-counter-container');
    const charCount = document.getElementById('main-char-count');
    const submitBtn = document.querySelector('#main-comment-form .submit-btn');
    
    if (textarea) {
        textarea.value = '';
        textarea.classList.remove('expanded');
        textarea.rows = 1;
    }
    
    if (actions) {
        actions.style.display = 'none';
    }
    
    // üìä –°–ö–†–´–¢–¨ –°–ß–ï–¢–ß–ò–ö
    if (charCounterContainer) {
        charCounterContainer.style.display = 'none';
    }
    
    if (charCount) {
        charCount.textContent = '0'; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º 0 –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
        charCount.parentElement.className = 'text-muted char-counter small';
    }
    
    if (submitBtn) {
        submitBtn.disabled = true;
    }
}
</script>

<!-- –°–¢–ò–õ–ò -->
<style>
.youtube-comments {
    background: #f8f9fa;
    border-radius: 12px;
    padding: 2rem;
    margin-top: 2rem;
}

.avatar-circle {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 14px;
    transition: transform 0.2s ease;
}

.avatar-circle:hover {
    transform: scale(1.05);
}

.avatar-circle-small {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 11px;
}

.comment-item {
    background: white;
    border-radius: 8px;
    padding: 1rem;
    transition: all 0.3s ease;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.comment-item:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
}

.comment-author {
    color: #065fd4;
    font-weight: 600;
    font-size: 13px;
}

.comment-time {
    font-size: 12px;
}

.comment-text p {
    color: #0f0f0f;
    font-size: 14px;
    line-height: 1.4;
}

.reaction-btn {
    border-radius: 18px;
    padding: 4px 8px;
    font-size: 12px;
    font-weight: 500;
    transition: all 0.2s ease;
    text-decoration: none;
}

.reaction-btn:hover {
    transform: translateY(-1px);
    text-decoration: none;
}

.reply-btn {
    border-radius: 18px;
    padding: 4px 12px;
    font-size: 12px;
    font-weight: 500;
}

.reply-form-inline {
    border-left: 3px solid #007bff;
    background: #f8f9fa !important;
}

.replies-section {
    background: rgba(248, 249, 250, 0.7);
    border-radius: 8px;
    padding: 0.5rem;
}

.reply-item {
    background: white;
    border-radius: 6px;
    padding: 0.75rem;
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
}

.reply-author {
    color: #065fd4;
    font-weight: 500;
    font-size: 12px;
}

.reply-time {
    font-size: 11px;
}

.auth-prompt {
    border: 2px dashed #dee2e6;
}

.no-comments {
    background: white;
    border-radius: 12px;
    margin: 2rem 0;
}

.char-counter.text-warning {
    color: #ffc107 !important;
}

.char-counter.text-danger {
    color: #dc3545 !important;
}

/* AJAX –∫–Ω–æ–ø–∫–∏ —Ä–µ–∞–∫—Ü–∏–π */
.ajax-reaction-btn {
    border-radius: 18px;
    padding: 4px 8px;
    font-size: 12px;
    font-weight: 500;
    transition: all 0.2s ease;
    text-decoration: none;
}

.ajax-reaction-btn:hover {
    transform: translateY(-1px);
}

.ajax-reaction-btn.active {
    background-color: var(--bs-primary);
    color: white;
    border-color: var(--bs-primary);
}

.ajax-reaction-btn.like-btn.active {
    background-color: #28a745;
    border-color: #28a745;
}

.ajax-reaction-btn.dislike-btn.active {
    background-color: #dc3545;
    border-color: #dc3545;
}

.reaction-clicked {
    transform: scale(1.2);
    transition: transform 0.2s ease;
}

/* –ö–Ω–æ–ø–∫–∞ –ø–æ–∫–∞–∑–∞/—Å–∫—Ä—ã—Ç–∏—è –æ—Ç–≤–µ—Ç–æ–≤ (–∫–∞–∫ –≤ YouTube) */
.replies-toggle-btn {
    font-size: 13px;
    font-weight: 600;
    color: #065fd4 !important;
    text-decoration: none;
    border: none;
    background: none;
    padding: 8px 0;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
}

.replies-toggle-btn:hover {
    color: #0a84ff !important;
    background-color: rgba(6, 95, 212, 0.1);
    border-radius: 16px;
    padding: 8px 12px;
    text-decoration: none;
    transform: translateY(-1px);
}

.replies-toggle-btn:focus {
    outline: none;
    box-shadow: 0 0 0 2px rgba(6, 95, 212, 0.2);
    border-radius: 16px;
}

.replies-toggle-btn .toggle-icon {
    transition: transform 0.3s ease;
    font-size: 12px;
}

.replies-toggle-btn .toggle-text {
    font-size: 13px;
    font-weight: 500;
}

/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –æ—Ç–≤–µ—Ç–æ–≤ */
.replies-section {
    background: rgba(248, 249, 250, 0.7);
    border-radius: 8px;
    padding: 0.5rem;
    margin-top: 0.5rem;
}

/* –ö—Ä–∞—Å–∏–≤–∞—è –∑–∞–∫—Ä—É–≥–ª–µ–Ω–Ω–∞—è –ª–∏–Ω–∏—è-—Å–∫–æ–±–∫–∞ –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤ */
.curved-reply-border {
    position: relative;
    margin-left: 20px;
}

.curved-reply-border::before {
    content: '';
    position: absolute;
    left: -20px;
    top: 0;
    bottom: 30px;
    width: 16px;
    border-left: 3px solid #2B5AA0; /* –û—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç —Å–∞–π—Ç–∞ */
    border-bottom: 3px solid #2B5AA0;
    border-bottom-left-radius: 16px;
}

/* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–æ–≤ */
.animate-fade-in {
    animation: fadeInReply 0.4s ease-out;
}

@keyframes fadeInReply {
    from {
        opacity: 0;
        transform: translateY(-5px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ */
.action-buttons {
    gap: 8px;
}

.action-buttons .btn {
    min-height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 6px 16px;
    font-size: 13px;
    font-weight: 500;
    border-radius: 18px;
    line-height: 1;
    white-space: nowrap;
    min-width: 80px; /* –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –∫–Ω–æ–ø–∫–∏ */
}

.action-buttons .btn-secondary {
    background-color: #f1f3f4;
    border-color: #f1f3f4;
    color: #3c4043;
}

.action-buttons .btn-secondary:hover {
    background-color: #e8eaed;
    border-color: #e8eaed;
    color: #3c4043;
}

.action-buttons .btn-primary {
    background-color: #065fd4;
    border-color: #065fd4;
    color: white;
    min-width: 140px; /* –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ö–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å" */
}

.action-buttons .btn-primary:hover {
    background-color: #0a84ff;
    border-color: #0a84ff;
}

.action-buttons .btn-primary:disabled {
    background-color: #cccccc;
    border-color: #cccccc;
    color: #666666;
    cursor: not-allowed;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
    .youtube-comments {
        padding: 1rem;
        border-radius: 8px;
    }
    
    .avatar-circle {
        width: 32px;
        height: 32px;
        font-size: 12px;
    }
    
    .avatar-circle-small {
        width: 24px;
        height: 24px;
        font-size: 10px;
    }
    
    .comment-item {
        padding: 0.75rem;
    }
    
    .replies-section {
        padding: 0.25rem;
    }

    /* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
    .action-buttons {
        gap: 6px; /* –ú–µ–Ω—å—à–∏–π –æ—Ç—Å—Ç—É–ø */
    }
    
    .action-buttons .btn {
        font-size: 11px;
        padding: 6px 12px;
        min-height: 32px;
        flex: 1; /* –ö–Ω–æ–ø–∫–∏ –¥–µ–ª—è—Ç –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –ø–æ—Ä–æ–≤–Ω—É */
        white-space: nowrap;
    }
    
    .action-buttons .btn-primary {
        min-width: 110px; /* –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –¥–ª—è —Ç–µ–∫—Å—Ç–∞ —Å –∏–∫–æ–Ω–∫–æ–π */
    }
    
    .action-buttons .btn-secondary {
        min-width: 70px;
    }
    
    /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ */
    .add-comment-section {
        padding: 0 0.5rem;
    }
    
    .flex-grow-1 {
        min-width: 0; /* –ü–æ–∑–≤–æ–ª—è–µ—Ç —Å–∂–∏–º–∞—Ç—å—Å—è */
        width: 100%;
    }
    
    #main-comment-textarea {
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
    }
    
    /* –°—á–µ—Ç—á–∏–∫ —Å–∏–º–≤–æ–ª–æ–≤ */
    .char-counter {
        font-size: 11px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–µ–π—Å—Ç–≤–∏–π */
    #main-comment-actions {
        margin-top: 8px;
    }
    
    .d-flex.justify-content-between {
        flex-direction: row; /* –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ */
        gap: 8px;
        align-items: center;
    }
}
</style>
