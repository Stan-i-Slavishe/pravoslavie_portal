{% extends 'base.html' %}
{% load static %}

{% block title %}–ì–ª–∞–≤–Ω–∞—è - {{ site_settings.site_name|default:"–î–æ–±—Ä—ã–µ –∏—Å—Ç–æ—Ä–∏–∏" }}{% endblock %}

{% block content %}
<!-- –ì–ª–∞–≤–Ω–∞—è —Å–µ–∫—Ü–∏—è –≤ —Å—Ç–∏–ª–µ Azbyka -->
<div class="hero-section">
    <div class="row align-items-center">
        <div class="col-lg-8">
            <h1>
                <span class="orthodox-cross"></span>
                –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Ç–µ–ø–ª—ã–π –º–∏—Ä –î–æ–±—Ä—ã—Ö –∏—Å—Ç–æ—Ä–∏–π
            </h1>
            <p class="lead">{{ site_settings.site_description|default:"–î—É—Ö–æ–≤–Ω—ã–µ —Ä–∞—Å—Å–∫–∞–∑—ã, –∫–Ω–∏–≥–∏ –∏ –∞—É–¥–∏–æ –¥–ª—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞" }}</p>
            <div class="mt-4">
                {% url 'stories:list' as stories_url %}
                <a href="{% if stories_url %}{{ stories_url }}{% else %}#stories{% endif %}" class="btn btn-primary">
                    <i class="bi bi-play-circle me-2"></i>
                    –í–∏–¥–µ–æ-—Ä–∞—Å—Å–∫–∞–∑—ã
                </a>
                {% url 'books:list' as books_url %}
                <a href="{% if books_url %}{{ books_url }}{% else %}#books{% endif %}" class="btn btn-outline-light">
                    <i class="bi bi-book me-2"></i>
                    –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞
                </a>
            </div>
        </div>
        <div class="col-lg-4 text-center">
            <i class="bi bi-heart-fill" style="font-size: 6rem; color: var(--accent-color); opacity: 0.3;"></i>
        </div>
    </div>
</div>

<!-- –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã -->
<div class="row mb-5">
    <div class="col-12">
        <h2 class="text-center mb-4">–ù–∞—à–∏ —Ä–∞–∑–¥–µ–ª—ã</h2>
    </div>
</div>

<div class="row g-4 mb-5 justify-content-center">
    <!-- –í–∏–¥–µ–æ-—Ä–∞—Å—Å–∫–∞–∑—ã -->
    <div class="col-lg-4 col-md-6 col-sm-12">
        <div class="card h-100">
            <div class="card-body text-center">
                <div class="mb-3">
                    <i class="bi bi-play-circle-fill section-icon icon-stories"></i>
                </div>
                <h5 class="card-title text-center">–í–∏–¥–µ–æ-—Ä–∞—Å—Å–∫–∞–∑—ã</h5>
                <p class="card-text">–î—É—Ö–æ–≤–Ω—ã–µ –∏—Å—Ç–æ—Ä–∏–∏ –∏ —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–∞, –∫–æ—Ç–æ—Ä—ã–µ –≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—Ç –∏ –ø–æ—É—á–∞—é—Ç</p>
                {% if story_categories %}
                    <div class="mb-3">
                        {% for category in story_categories %}
                            <span class="badge" style="background-color: {{ category.color }}; color: white; margin: 0.1rem;">{{ category.name }}</span>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="mb-3">
                        <span class="badge bg-danger text-white">–î—É—Ö–æ–≤–Ω—ã–µ –∏—Å—Ç–æ—Ä–∏–∏</span>
                        <span class="badge bg-warning text-white">–ß—É–¥–µ—Å–∞</span>
                    </div>
                {% endif %}
                {% url 'stories:list' as stories_url %}
                <a href="{% if stories_url %}{{ stories_url }}{% else %}#stories{% endif %}" class="btn btn-primary">
                    –ü–µ—Ä–µ–π—Ç–∏
                </a>
            </div>
        </div>
    </div>

    <!-- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ -->
    <div class="col-lg-4 col-md-6 col-sm-12">
        <div class="card h-100">
            <div class="card-body text-center">
                <div class="mb-3">
                    <i class="bi bi-book-fill section-icon icon-books"></i>
                </div>
                <h5 class="card-title text-center">–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞</h5>
                <p class="card-text">–ü—Ä–∞–≤–æ—Å–ª–∞–≤–Ω—ã–µ –∫–Ω–∏–≥–∏, —Å—Ç–∞—Ç—å–∏ –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –¥–ª—è —É–≥–ª—É–±–ª–µ–Ω–∏—è –≤–µ—Ä—ã</p>
                {% if book_categories %}
                    <div class="mb-3">
                        {% for category in book_categories %}
                            <span class="badge" style="background-color: {{ category.color }}; color: white; margin: 0.1rem;">{{ category.name }}</span>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="mb-3">
                        <span class="badge bg-success text-white">–ë–æ–≥–æ—Å–ª–æ–≤–∏–µ</span>
                        <span class="badge bg-primary text-white">–ñ–∏—Ç–∏—è</span>
                    </div>
                {% endif %}
                {% url 'books:list' as books_url %}
                <a href="{% if books_url %}{{ books_url }}{% else %}#books{% endif %}" class="btn btn-primary">
                    –ü–µ—Ä–µ–π—Ç–∏
                </a>
            </div>
        </div>
    </div>

    <!-- –ê—É–¥–∏–æ -->
    <div class="col-lg-4 col-md-6 col-sm-12">
        <div class="card h-100">
            <div class="card-body text-center">
                <div class="mb-3">
                    <i class="bi bi-music-note-beamed section-icon icon-audio"></i>
                </div>
                <h5 class="card-title text-center">–ê—É–¥–∏–æ-–∫–æ–Ω—Ç–µ–Ω—Ç</h5>
                <p class="card-text">–ü—Ä–æ–ø–æ–≤–µ–¥–∏, –∞–∫–∞—Ñ–∏—Å—Ç—ã, –¥—É—Ö–æ–≤–Ω–∞—è –º—É–∑—ã–∫–∞ –∏ –∞—É–¥–∏–æ–∫–Ω–∏–≥–∏</p>
                {% if audio_categories %}
                    <div class="mb-3">
                        {% for category in audio_categories %}
                            <span class="badge" style="background-color: {{ category.color }}; color: white; margin: 0.1rem;">{{ category.name }}</span>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="mb-3">
                        <span class="badge bg-info text-white">–ü—Ä–æ–ø–æ–≤–µ–¥–∏</span>
                        <span class="badge bg-warning text-white">–ê–∫–∞—Ñ–∏—Å—Ç—ã</span>
                    </div>
                {% endif %}
                {% url 'audio:list' as audio_url %}
                <a href="{% if audio_url %}{{ audio_url }}{% else %}#audio{% endif %}" class="btn btn-primary">
                    –ü–µ—Ä–µ–π—Ç–∏
                </a>
            </div>
        </div>
    </div>
</div>

<!-- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–µ–≥–∏ -->
<div class="popular-tags-section">
    <div class="row">
        <div class="col-12">
            <h3>–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–µ–º—ã</h3>
            <div class="tag-cloud-wrapper">
                <div class="tag-cloud">
                    {% if popular_tags %}
                        {% for tag in popular_tags %}
                            {% if tag.slug %}
                                {% url 'core:tag' slug=tag.slug as tag_url %}
                                <a href="{% if tag_url %}{{ tag_url }}{% else %}#tag-{{ tag.slug }}{% endif %}" 
                                   class="badge rounded-pill me-2 mb-2 tag-link"
                                   style="background-color: {{ tag.color }}; text-decoration: none; padding: 8px 12px;">
                                    {{ tag.name }}
                                </a>
                            {% endif %}
                        {% endfor %}
                    {% else %}
                        <!-- –î–µ–º–æ —Ç–µ–≥–∏ -->
                        <a href="#" class="badge rounded-pill tag-link me-2 mb-2" style="background-color: #e74c3c; color: white; text-decoration: none; padding: 8px 12px;">–≤–µ—Ä–∞</a>
                        <a href="#" class="badge rounded-pill tag-link me-2 mb-2" style="background-color: #3498db; color: white; text-decoration: none; padding: 8px 12px;">–∏—Å–ø–æ–≤–µ–¥—å</a>
                        <a href="#" class="badge rounded-pill tag-link me-2 mb-2" style="background-color: #2ecc71; color: white; text-decoration: none; padding: 8px 12px;">–≤–æ—Å–ø–∏—Ç–∞–Ω–∏–µ</a>
                        <a href="#" class="badge rounded-pill tag-link me-2 mb-2" style="background-color: #f39c12; color: white; text-decoration: none; padding: 8px 12px;">–º–æ–ª–∏—Ç–≤–∞</a>
                        <a href="#" class="badge rounded-pill tag-link me-2 mb-2" style="background-color: #9b59b6; color: white; text-decoration: none; padding: 8px 12px;">–ª—é–±–æ–≤—å</a>
                        <a href="#" class="badge rounded-pill tag-link me-2 mb-2" style="background-color: #1abc9c; color: white; text-decoration: none; padding: 8px 12px;">–Ω–∞–¥–µ–∂–¥–∞</a>
                    {% endif %}
                </div>
            </div>
            <div class="all-tags-btn">
                {% url 'core:tags' as tags_url %}
                <a href="{% if tags_url %}{{ tags_url }}{% else %}#tags{% endif %}" class="btn btn-outline-secondary btn-sm">
                    <i class="bi bi-tags"></i> –í—Å–µ —Ç–µ–≥–∏
                </a>
            </div>
        </div>
    </div>
</div>

<!-- –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏ -->
{% include 'core/social_media_widget.html' %}

<!-- –ü—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é -->
<div class="cta-section" id="ctaSection">
    <button class="cta-close" onclick="closeCTA()" title="–ó–∞–∫—Ä—ã—Ç—å">&times;</button>
    <h3>–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ –Ω–∞–º!</h3>
    <p>–ü–æ–ª—É—á–∞–π—Ç–µ –¥–æ—Å—Ç—É–ø –∫ —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–º –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º</p>
    <div>
        {% if not user.is_authenticated %}
            <a href="{% url 'account_signup' %}" class="btn btn-primary">
                <i class="bi bi-person-plus me-1"></i>
                –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
            </a>
            <a href="{% url 'account_login' %}" class="btn btn-outline-secondary">
                <i class="bi bi-box-arrow-in-right me-1"></i>
                –í–æ–π—Ç–∏
            </a>
        {% else %}
            {% url 'shop:catalog' as shop_url %}
            <a href="{% if shop_url %}{{ shop_url }}{% else %}/shop/{% endif %}" class="btn btn-primary">
                <i class="bi bi-star me-1"></i>
                –ú–∞–≥–∞–∑–∏–Ω
            </a>
        {% endif %}
        
        <!-- –ö–Ω–æ–ø–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è -->
        <button class="btn btn-warning ms-2" 
                onclick="event.preventDefault(); event.stopPropagation(); console.log('üî¥ –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ!'); showOurSubscriptionModal(); return false;" 
                id="subscribe-updates-btn"
                type="button">
            <i class="bi bi-bell me-1"></i>
            –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
        </button>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// üè† –§—É–Ω–∫—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è CTA –±–ª–æ–∫–∞
function closeCTA() {
    // –ò—â–µ–º CTA –±–ª–æ–∫ –ø–æ —Ä–∞–∑–Ω—ã–º —Å–ø–æ—Å–æ–±–∞–º
    let ctaSection = document.getElementById('ctaSection');
    
    if (!ctaSection) {
        ctaSection = document.querySelector('.cta-section');
    }
    
    if (!ctaSection) {
        ctaSection = document.querySelector('[class*="cta"]');
    }
    
    if (ctaSection) {
        // –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ —Å–∫—Ä—ã—Ç–∏–µ
        ctaSection.style.display = 'none';
        ctaSection.style.visibility = 'hidden';
        ctaSection.style.opacity = '0';
        
        // –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –∑–∞ –ø—Ä–µ–¥–µ–ª—ã —ç–∫—Ä–∞–Ω–∞
        ctaSection.style.transform = 'translateX(200%)';
        
        // –ö–ª–∞—Å—Å—ã —Å–∫—Ä—ã—Ç–∏—è
        ctaSection.classList.add('hidden');
        ctaSection.classList.add('d-none');
        
        // –ö—Ä–∞—Å–∏–≤–∞—è –∞–Ω–∏–º–∞—Ü–∏—è
        ctaSection.style.animation = 'slideOutRight 0.4s ease forwards';
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
        localStorage.setItem('ctaClosed', 'true');
        
        // –ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 500–º—Å
        setTimeout(() => {
            if (ctaSection && ctaSection.parentNode) {
                ctaSection.remove();
            }
        }, 500);
    } else {
        // –ü–æ—Å–ª–µ–¥–Ω—è—è –ø–æ–ø—ã—Ç–∫–∞ - —É–¥–∞–ª—è–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ CTA
        const allCTA = document.querySelectorAll('.cta-section, #ctaSection, [class*="cta"], [id*="cta"]');
        allCTA.forEach((el) => {
            el.style.display = 'none';
            el.remove();
        });
    }
}

// –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ, –Ω—É–∂–Ω–æ –ª–∏ —Å–∫—Ä—ã–≤–∞—Ç—å CTA
document.addEventListener('DOMContentLoaded', function() {
    const ctaSection = document.getElementById('ctaSection');
    const ctaClosed = localStorage.getItem('ctaClosed');
    
    if (ctaClosed === 'true' && ctaSection) {
        ctaSection.classList.add('hidden');
    }
    
    // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –ø–æ–¥–ø–∏—Å–∫–∏
    const subscribeBtn = document.getElementById('subscribe-updates-btn');
    if (subscribeBtn) {
        subscribeBtn.onclick = null;
        subscribeBtn.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            e.stopImmediatePropagation();
            showOurSubscriptionModal();
            return false;
        }, true);
    }
    
    // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º CTA –±–ª–æ–∫
    if (ctaSection) {
        ctaSection.style.zIndex = '9999';
        ctaSection.style.pointerEvents = 'auto';
        
        // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –∑–∞–∫—Ä—ã—Ç–∏—è
        const closeButton = ctaSection.querySelector('.cta-close');
        if (closeButton) {
            closeButton.onclick = null;
            closeButton.removeAttribute('onclick');
            closeButton.style.pointerEvents = 'auto';
            closeButton.style.zIndex = '10001';
            closeButton.style.position = 'absolute';
            closeButton.style.cursor = 'pointer';
            
            closeButton.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                e.stopImmediatePropagation();
                closeCTA();
                return false;
            }, true);
            
            closeButton.addEventListener('mousedown', function(e) {
                e.preventDefault();
                closeCTA();
            }, true);
            
            closeButton.addEventListener('touchstart', function(e) {
                e.preventDefault();
                closeCTA();
            }, true);
        }
        
        // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
        const ctaButtons = ctaSection.querySelectorAll('a, button');
        ctaButtons.forEach((btn) => {
            btn.style.pointerEvents = 'auto';
            btn.style.zIndex = '10000';
            btn.style.position = 'relative';
            btn.style.cursor = 'pointer';
            btn.removeEventListener('click', handleCTAClick);
            btn.addEventListener('click', handleCTAClick, true);
        });
    }
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–æ–≤ –ø–æ CTA –∫–Ω–æ–ø–∫–∞–º
function handleCTAClick(e) {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å—Å—ã–ª–∫–∞ –Ω–µ –ø—É—Å—Ç–∞—è
    if (!this.href || this.href.includes('#')) {
        e.preventDefault();
        e.stopPropagation();
        alert('üîß –≠—Ç–∞ –∫–Ω–æ–ø–∫–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ. –¢–µ–∫—Å—Ç: ' + this.textContent.trim());
        return false;
    }
    
    // –ï—Å–ª–∏ —ç—Ç–æ –∫–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è
    if (this.classList.contains('cta-close')) {
        e.preventDefault();
        e.stopPropagation();
        closeCTA();
        return false;
    }
    
    // –î–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫ —Ä–∞–∑—Ä–µ—à–∞–µ–º –ø–µ—Ä–µ—Ö–æ–¥
    return true;
}

// üìß –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
function showOurSubscriptionModal() {
    // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
    const existingModals = document.querySelectorAll('.subscription-modal, .subscribe-popup');
    existingModals.forEach(modal => modal.remove());
    
    const modal = document.createElement('div');
    modal.className = 'subscription-modal';
    modal.id = 'our-subscription-modal'; // –î–æ–±–∞–≤–ª—è–µ–º ID –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
    modal.innerHTML = `
        <div class="modal-overlay" style="
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 20000;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        ">
            <div class="modal-content" style="
                background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
                border-radius: 15px;
                padding: 25px;
                max-width: 480px;
                width: 90%;
                max-height: 90vh;
                overflow-y: auto;
                text-align: center;
                box-shadow: 0 15px 40px rgba(0,0,0,0.25);
                position: relative;
                animation: slideInUp 0.4s ease;
                border: 2px solid #2B5AA0;
            ">
                <button class="close-btn" onclick="closeOurSubscriptionModal(); return false;" style="
                    position: absolute;
                    top: 15px;
                    right: 20px;
                    background: none;
                    border: none;
                    font-size: 28px;
                    cursor: pointer;
                    color: #999;
                    transition: color 0.3s;
                    padding: 5px;
                ">&times;</button>
                
                <div style="margin-bottom: 20px;">
                    <div style="
                        background: linear-gradient(135deg, #2B5AA0, #1e4080);
                        width: 60px;
                        height: 60px;
                        border-radius: 50%;
                        margin: 0 auto 15px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        box-shadow: 0 6px 20px rgba(43, 90, 160, 0.3);
                    ">
                        <i class="bi bi-bell-fill" style="font-size: 2rem; color: white;"></i>
                    </div>
                    
                    <h3 style="color: #2B5AA0; margin-bottom: 8px; font-size: 1.5rem; font-weight: 700;">
                        üîî –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                    </h3>
                    <p style="color: #666; font-size: 1rem; line-height: 1.4; margin-bottom: 0;">
                        –ë—É–¥—å—Ç–µ –≤ –∫—É—Ä—Å–µ –≤—Å–µ—Ö –Ω–æ–≤–æ—Å—Ç–µ–π –∏ –ø–æ–ª—É—á–∞–π—Ç–µ —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç!
                    </p>
                </div>
                
                <div style="margin-bottom: 20px; text-align: left;">
                    <label style="display: block; margin-bottom: 12px; font-weight: 600; color: #333; font-size: 14px;">
                        üì´ –í–∞—à email –∞–¥—Ä–µ—Å:
                    </label>
                    <input type="email" 
                           id="subscription-email" 
                           placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à email" 
                           style="
                               width: 100%;
                               padding: 12px 16px;
                               border: 2px solid #e1e5e9;
                               border-radius: 10px;
                               font-size: 15px;
                               transition: all 0.3s ease;
                               background: white;
                               box-shadow: 0 2px 6px rgba(0,0,0,0.08);
                           "
                           required>
                </div>
                
                <div style="margin-bottom: 20px; text-align: left;">
                    <label style="display: block; margin-bottom: 12px; font-weight: 600; color: #333; font-size: 14px;">
                        üéÜ –ù–∞ —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è? (–º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ):
                    </label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 12px;">
                        <label style="
                            display: flex;
                            align-items: center;
                            padding: 8px 12px;
                            background: #f8f9fa;
                            border: 2px solid #e9ecef;
                            border-radius: 8px;
                            cursor: pointer;
                            transition: all 0.3s ease;
                            font-size: 13px;
                        " class="subscription-option">
                            <input type="checkbox" name="subscription_types" value="stories" 
                                   style="margin-right: 8px; transform: scale(1.1);">
                            <span>üé• –ù–æ–≤—ã–µ –≤–∏–¥–µ–æ-—Ä–∞—Å—Å–∫–∞–∑—ã</span>
                        </label>
                        
                        <label style="
                            display: flex;
                            align-items: center;
                            padding: 8px 12px;
                            background: #f8f9fa;
                            border: 2px solid #e9ecef;
                            border-radius: 8px;
                            cursor: pointer;
                            transition: all 0.3s ease;
                            font-size: 13px;
                        " class="subscription-option">
                            <input type="checkbox" name="subscription_types" value="books" 
                                   style="margin-right: 8px; transform: scale(1.1);">
                            <span>üìö –ù–æ–≤—ã–µ –∫–Ω–∏–≥–∏</span>
                        </label>
                        
                        <label style="
                            display: flex;
                            align-items: center;
                            padding: 8px 12px;
                            background: #f8f9fa;
                            border: 2px solid #e9ecef;
                            border-radius: 8px;
                            cursor: pointer;
                            transition: all 0.3s ease;
                            font-size: 13px;
                        " class="subscription-option">
                            <input type="checkbox" name="subscription_types" value="fairy_tales" 
                                   style="margin-right: 8px; transform: scale(1.1);">
                            <span>üßö‚Äç‚ôÄÔ∏è –¢–µ—Ä–∞–ø–µ–≤—Ç–∏—á–µ—Å–∫–∏–µ —Å–∫–∞–∑–∫–∏</span>
                        </label>
                        
                        <label style="
                            display: flex;
                            align-items: center;
                            padding: 8px 12px;
                            background: #f8f9fa;
                            border: 2px solid #e9ecef;
                            border-radius: 8px;
                            cursor: pointer;
                            transition: all 0.3s ease;
                            font-size: 13px;
                        " class="subscription-option">
                            <input type="checkbox" name="subscription_types" value="audio" 
                                   style="margin-right: 8px; transform: scale(1.1);">
                            <span>üéß –ê—É–¥–∏–æ-–∫–æ–Ω—Ç–µ–Ω—Ç</span>
                        </label>
                        
                        <label style="
                            display: flex;
                            align-items: center;
                            padding: 8px 12px;
                            background: #f8f9fa;
                            border: 2px solid #e9ecef;
                            border-radius: 8px;
                            cursor: pointer;
                            transition: all 0.3s ease;
                            font-size: 13px;
                        " class="subscription-option">
                            <input type="checkbox" name="subscription_types" value="shop" 
                                   style="margin-right: 8px; transform: scale(1.1);">
                            <span>üõí –ó–∞–ø—É—Å–∫ –º–∞–≥–∞–∑–∏–Ω–∞</span>
                        </label>
                        
                        <label style="
                            display: flex;
                            align-items: center;
                            padding: 8px 12px;
                            background: #f8f9fa;
                            border: 2px solid #e9ecef;
                            border-radius: 8px;
                            cursor: pointer;
                            transition: all 0.3s ease;
                            font-size: 13px;
                        " class="subscription-option">
                            <input type="checkbox" name="subscription_types" value="special" 
                                   style="margin-right: 8px; transform: scale(1.1);">
                            <span>‚ú® –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è</span>
                        </label>
                    </div>
                    
                    <div style="margin-top: 10px;">
                        <label style="
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            padding: 10px;
                            background: linear-gradient(135deg, #ffd700, #ffed4e);
                            border: 2px solid #f39c12;
                            border-radius: 10px;
                            cursor: pointer;
                            transition: all 0.3s ease;
                            font-weight: 600;
                            font-size: 13px;
                            color: #8b4513;
                        " class="subscription-option special">
                            <input type="checkbox" name="subscription_types" value="all" 
                                   style="margin-right: 8px; transform: scale(1.2);">
                            <span>üåü –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –≤—Å—ë —Å—Ä–∞–∑—É!</span>
                        </label>
                    </div>
                </div>
                
                <div style="display: flex; gap: 12px; margin-top: 20px;">
                    <button onclick="submitSubscription()" style="
                        flex: 1;
                        background: linear-gradient(135deg, #2B5AA0, #1e4080);
                        color: white;
                        border: none;
                        padding: 12px 20px;
                        border-radius: 10px;
                        cursor: pointer;
                        font-weight: 700;
                        font-size: 15px;
                        transition: all 0.3s ease;
                        box-shadow: 0 3px 12px rgba(43, 90, 160, 0.3);
                    ">
                        üöÄ –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è
                    </button>
                    <button onclick="closeOurSubscriptionModal()" style="
                        background: #6c757d;
                        color: white;
                        border: none;
                        padding: 12px 20px;
                        border-radius: 10px;
                        cursor: pointer;
                        font-weight: 600;
                        font-size: 14px;
                        transition: all 0.3s ease;
                    ">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                </div>
                
                <div id="subscription-result" style="
                    margin-top: 15px;
                    padding: 12px;
                    border-radius: 8px;
                    display: none;
                    font-weight: 600;
                    font-size: 14px;
                "></div>
                
                <div style="margin-top: 15px; font-size: 11px; color: #999; text-align: center;">
                    üîí –ú—ã —Ü–µ–Ω–∏–º –≤–∞—à—É –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å. –ù–∏–∫–æ–º—É –Ω–µ –ø–µ—Ä–µ–¥–∞–µ–º –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ.
                </div>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    
    // –î–æ–±–∞–≤–ª—è–µ–º CSS –∞–Ω–∏–º–∞—Ü–∏–∏
    const style = document.createElement('style');
    style.textContent = `
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideInUp {
            from { 
                opacity: 0;
                transform: translateY(50px) scale(0.95);
            }
            to { 
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        @keyframes fadeOut {
            from { 
                opacity: 1; 
                transform: scale(1);
            }
            to { 
                opacity: 0;
                transform: scale(0.95);
            }
        }
        
        .subscription-option:hover {
            background: #e3f2fd !important;
            border-color: #2B5AA0 !important;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(43, 90, 160, 0.2);
        }
        
        .subscription-option.special:hover {
            background: linear-gradient(135deg, #ffed4e, #ffd700) !important;
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 6px 20px rgba(243, 156, 18, 0.4);
        }
        
        .subscription-option input:checked {
            accent-color: #2B5AA0;
        }
        
        #subscription-email:focus {
            border-color: #2B5AA0;
            outline: none;
            box-shadow: 0 0 0 3px rgba(43, 90, 160, 0.1);
        }
        
        .close-btn:hover {
            color: #dc3545 !important;
            transform: scale(1.1);
        }
    `;
    document.head.appendChild(style);
    
    // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ email
    setTimeout(() => {
        const emailField = document.getElementById('subscription-email');
        if (emailField) emailField.focus();
    }, 400);
    
    // üîß –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫—Ä–µ—Å—Ç–∏–∫ –æ—Ç–¥–µ–ª—å–Ω–æ
    const closeBtn = modal.querySelector('.close-btn');
    if (closeBtn) {
        closeBtn.onclick = null;
        closeBtn.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            closeOurSubscriptionModal();
            return false;
        }, true);
    }
    
    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    modal.querySelector('.modal-overlay').addEventListener('click', function(e) {
        if (e.target === this) {
            closeOurSubscriptionModal();
        }
    });
    
    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ Escape
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closeOurSubscriptionModal();
        }
    });
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ "–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –≤—Å—ë"
    const allCheckbox = modal.querySelector('input[value="all"]');
    const otherCheckboxes = modal.querySelectorAll('input[name="subscription_types"]:not([value="all"])');
    
    allCheckbox.addEventListener('change', function() {
        if (this.checked) {
            otherCheckboxes.forEach(cb => {
                cb.checked = true;
                cb.parentElement.style.background = '#e3f2fd';
                cb.parentElement.style.borderColor = '#2B5AA0';
            });
        } else {
            otherCheckboxes.forEach(cb => {
                cb.checked = false;
                cb.parentElement.style.background = '#f8f9fa';
                cb.parentElement.style.borderColor = '#e9ecef';
            });
        }
    });
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö —á–µ–∫–±–æ–∫—Å–æ–≤
    otherCheckboxes.forEach(cb => {
        cb.addEventListener('change', function() {
            if (!this.checked) {
                allCheckbox.checked = false;
                allCheckbox.parentElement.style.background = 'linear-gradient(135deg, #ffd700, #ffed4e)';
                allCheckbox.parentElement.style.borderColor = '#f39c12';
            }
            
            // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
            if (this.checked) {
                this.parentElement.style.background = '#e3f2fd';
                this.parentElement.style.borderColor = '#2B5AA0';
            } else {
                this.parentElement.style.background = '#f8f9fa';
                this.parentElement.style.borderColor = '#e9ecef';
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—Å–µ –ª–∏ –æ—Ç–º–µ—á–µ–Ω—ã
            const allChecked = Array.from(otherCheckboxes).every(checkbox => checkbox.checked);
            if (allChecked) {
                allCheckbox.checked = true;
                allCheckbox.parentElement.style.background = 'linear-gradient(135deg, #90EE90, #32CD32)';
                allCheckbox.parentElement.style.borderColor = '#28a745';
            }
        });
    });
}

// –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
function closeOurSubscriptionModal() {
    console.log('üí´ –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ...');
    
    // –ò—â–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ ID (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
    let modal = document.getElementById('our-subscription-modal');
    
    if (!modal) {
        // –ï—Å–ª–∏ –ø–æ ID –Ω–µ –Ω–∞—à–ª–∏, –∏—â–µ–º –ø–æ –∫–ª–∞—Å—Å–∞–º
        modal = document.querySelector('.subscription-modal') || 
                document.querySelector('[class*="subscription"]') ||
                document.querySelector('.modal-overlay')?.parentElement;
    }
    
    if (modal) {
        console.log('‚úÖ –ù–∞–π–¥–µ–Ω–æ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ:', modal);
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –∑–∞–∫—Ä—ã—Ç–∏—è
        modal.style.animation = 'fadeOut 0.3s ease forwards';
        modal.style.opacity = '0';
        modal.style.transform = 'scale(0.9)';
        
        setTimeout(() => {
            if (modal && modal.parentNode) {
                modal.remove();
                console.log('üóëÔ∏è –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–¥–∞–ª–µ–Ω–æ');
            }
        }, 300);
    } else {
        console.log('‚ùå –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ!');
        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É–¥–∞–ª—è–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
        const allModals = document.querySelectorAll('.subscription-modal, .modal-overlay, [class*="modal"], #our-subscription-modal');
        console.log('üßπ –ù–∞–π–¥–µ–Ω–æ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è:', allModals.length);
        allModals.forEach((m, index) => {
            console.log(`üßπ –£–¥–∞–ª—è–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ ${index + 1}:`, m);
            m.remove();
        });
    }
}

// –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã –ø–æ–¥–ø–∏—Å–∫–∏
function submitSubscription() {
    const email = document.getElementById('subscription-email').value.trim();
    const resultDiv = document.getElementById('subscription-result');
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ email
    if (!email || !email.includes('@')) {
        resultDiv.style.display = 'block';
        resultDiv.style.background = '#f8d7da';
        resultDiv.style.color = '#721c24';
        resultDiv.innerHTML = '‚ö†Ô∏è –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email –∞–¥—Ä–µ—Å';
        return;
    }
    
    // –ü–æ–ª—É—á–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Ç–∏–ø—ã –ø–æ–¥–ø–∏—Å–æ–∫
    const selectedTypes = [];
    const checkboxes = document.querySelectorAll('input[name="subscription_types"]:checked');
    checkboxes.forEach(cb => selectedTypes.push(cb.value));
    
    if (selectedTypes.length === 0) {
        resultDiv.style.display = 'block';
        resultDiv.style.background = '#fff3cd';
        resultDiv.style.color = '#856404';
        resultDiv.innerHTML = 'üìù –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ç–∏–ø –ø–æ–¥–ø–∏—Å–∫–∏';
        return;
    }
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage (–¥–ª—è –¥–µ–º–æ)
    try {
        const subscriptions = JSON.parse(localStorage.getItem('subscriptions') || '[]');
        const newSubscription = {
            email: email,
            types: selectedTypes,
            date: new Date().toISOString(),
            id: Date.now()
        };
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ—Ç –ª–∏ —É–∂–µ —Ç–∞–∫–æ–≥–æ email
        const existingIndex = subscriptions.findIndex(sub => sub.email === email);
        if (existingIndex !== -1) {
            subscriptions[existingIndex] = newSubscription; // –û–±–Ω–æ–≤–ª—è–µ–º
        } else {
            subscriptions.push(newSubscription); // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π
        }
        
        localStorage.setItem('subscriptions', JSON.stringify(subscriptions));
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ø–µ—Ö
        resultDiv.style.display = 'block';
        resultDiv.style.background = '#d4edda';
        resultDiv.style.color = '#155724';
        
        const typeNames = {
            stories: '–≤–∏–¥–µ–æ-—Ä–∞—Å—Å–∫–∞–∑—ã',
            books: '–∫–Ω–∏–≥–∏', 
            fairy_tales: '—Å–∫–∞–∑–∫–∏',
            audio: '–∞—É–¥–∏–æ',
            shop: '–º–∞–≥–∞–∑–∏–Ω',
            special: '—Å–ø–µ—Ü–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è',
            all: '–≤—Å—ë'
        };
        
        const selectedNames = selectedTypes.map(type => typeNames[type] || type).join(', ');
        
        resultDiv.innerHTML = `
            ‚úÖ –û—Ç–ª–∏—á–Ω–æ! –í—ã –ø–æ–¥–ø–∏—Å–∞–ª–∏—Å—å –Ω–∞: <strong>${selectedNames}</strong><br>
            <small>–ú—ã —Å–æ–æ–±—â–∏–º –≤–∞–º –æ –≤—Å–µ—Ö –Ω–æ–≤–∏–Ω–∫–∞—Ö!</small>
        `;
        
        // –ó–∞–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
        setTimeout(() => {
            closeOurSubscriptionModal();
        }, 3000);
        
    } catch (error) {
        resultDiv.style.display = 'block';
        resultDiv.style.background = '#f8d7da';
        resultDiv.style.color = '#721c24';
        resultDiv.innerHTML = '‚ùå –û—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.';
        console.error('Subscription error:', error);
    }
}
</script>
{% endblock %}