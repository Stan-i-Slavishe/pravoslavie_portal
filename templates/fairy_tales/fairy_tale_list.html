{% extends 'base.html' %}
{% load static %}

{% block title %}–¢–µ—Ä–∞–ø–µ–≤—Ç–∏—á–µ—Å–∫–∏–µ —Å–∫–∞–∑–∫–∏ - {{ site_settings.site_name }}{% endblock %}

{% block description %}–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Ä–∞–ø–µ–≤—Ç–∏—á–µ—Å–∫–∏–µ —Å–∫–∞–∑–∫–∏ –¥–ª—è –¥–µ—Ç–µ–π –∏ –≤–∑—Ä–æ—Å–ª—ã—Ö{% endblock %}

{% block extra_head %}
<meta name="content-type" content="fairy_tale">
{% endblock %}

{% block extra_css %}
<style>
/* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–µ—Ä–∞–ø–µ–≤—Ç–∏—á–µ—Å–∫–∏—Ö —Å–∫–∞–∑–æ–∫ */
.fairy-tales-hero {
    background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
    border-radius: 1rem;
    padding: 3rem 2rem;
    margin-bottom: 2rem;
    text-align: center;
    color: white;
    position: relative;
    overflow: hidden;
}

.fairy-tales-hero::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
    animation: pulse 4s ease-in-out infinite;
}

.fairy-tales-hero-content {
    position: relative;
    z-index: 2;
}

.search-filters {
    background: #fff;
    border: 1px solid #e0e0e0;
    border-radius: 0.75rem;
    padding: 1.5rem;
    margin-bottom: 2rem;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.fairy-tale-card {
    background: #fff;
    border: 1px solid #e0e0e0;
    border-radius: 0.75rem;
    overflow: hidden;
    transition: all 0.3s ease;
    height: 100%;
    position: relative;
}

.fairy-tale-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    border-color: #4ecdc4;
}

.fairy-tale-image {
    position: relative;
    aspect-ratio: 16/10;
    background: linear-gradient(45deg, #4ecdc4, #44a08d);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 3rem;
    opacity: 0.8;
    overflow: hidden;
}

.fairy-tale-content {
    padding: 1.5rem;
}

.fairy-tale-title {
    font-size: 1.2rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: #2c3e50;
    text-decoration: none;
}

.fairy-tale-title:hover {
    color: #4ecdc4;
}

.fairy-tale-description {
    font-size: 0.9rem;
    color: #666;
    margin-bottom: 1rem;
    line-height: 1.4;
}

.age-badge {
    display: inline-block;
    background: #e8f4fd;
    color: #1976d2;
    padding: 0.25rem 0.5rem;
    border-radius: 1rem;
    font-size: 0.75rem;
    font-weight: 500;
    margin-right: 0.5rem;
}

.price-badge {
    display: inline-block;
    background: #e8f5e8;
    color: #2e7d32;
    padding: 0.25rem 0.5rem;
    border-radius: 1rem;
    font-size: 0.75rem;
    font-weight: 600;
}

.price-badge.free {
    background: #fff3e0;
    color: #f57c00;
}

.category-filter-btn {
    display: inline-block;
    padding: 0.5rem 1rem;
    margin: 0.25rem;
    border: 2px solid #e0e0e0;
    border-radius: 1.5rem;
    color: #666;
    text-decoration: none;
    transition: all 0.3s ease;
    font-size: 0.9rem;
    white-space: nowrap;
}

.category-filter-btn:hover,
.category-filter-btn.active {
    border-color: #4ecdc4;
    background: #4ecdc4;
    color: white;
    text-decoration: none;
}

.categories-container {
    position: relative;
}

.category-row {
    display: flex;
    flex-wrap: wrap;
    gap: 0.25rem;
    margin-bottom: 0.5rem;
    justify-content: flex-start;
    align-items: center;
}

/* –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –±–æ–ª–µ–µ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è */
.category-filter-btn {
    flex: 0 0 auto;
    min-width: fit-content;
}

@media (max-width: 768px) {
    .category-row {
        justify-content: center;
    }
}

.hidden-categories {
    opacity: 0;
    max-height: 0;
    overflow: hidden;
    transition: all 0.4s ease-out;
}

.hidden-categories.show {
    opacity: 1;
    max-height: 500px;
}

.toggle-categories-btn {
    background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
    border: none;
    color: white;
    padding: 0.4rem 1rem;
    border-radius: 1.5rem;
    font-size: 0.85rem;
    font-weight: 500;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    margin: 0.25rem;
}

.toggle-categories-btn:hover {
    background: linear-gradient(135deg, #44a08d 0%, #4ecdc4 100%);
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
}

.toggle-icon {
    transition: transform 0.3s ease;
}

.toggle-categories-btn.expanded .toggle-icon {
    transform: rotate(180deg);
}

.categories-counter {
    background: rgba(255, 255, 255, 0.2);
    color: white;
    padding: 0.1rem 0.5rem;
    border-radius: 1rem;
    font-size: 0.75rem;
    font-weight: 600;
}

.fade-in-up {
    animation: fadeInUp 0.4s ease-out forwards;
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.filter-row {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    align-items: center;
    margin-bottom: 1rem;
}

.search-input {
    flex: 1;
    min-width: 250px;
    padding: 0.75rem 1rem;
    border: 1px solid #ddd;
    border-radius: 0.5rem;
    font-size: 0.9rem;
}

.search-input:focus {
    outline: none;
    border-color: #4ecdc4;
    box-shadow: 0 0 0 2px rgba(78, 205, 196, 0.2);
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.8; }
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
    .fairy-tales-hero {
        padding: 2rem 1rem;
    }
    
    .search-filters {
        padding: 1rem;
    }
    
    .filter-row {
        flex-direction: column;
        align-items: stretch;
    }
    
    .search-input {
        min-width: auto;
    }
    
    .category-filter-btn {
        padding: 0.4rem 0.8rem;
        font-size: 0.8rem;
    }
    
    .toggle-categories-btn {
        padding: 0.3rem 0.8rem;
        font-size: 0.8rem;
    }
    
    .categories-counter {
        padding: 0.1rem 0.4rem;
        font-size: 0.7rem;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="container">
    <!-- Hero —Å–µ–∫—Ü–∏—è -->
    <div class="fairy-tales-hero">
        <div class="fairy-tales-hero-content">
            <h1 class="mb-3">üßö –¢–µ—Ä–∞–ø–µ–≤—Ç–∏—á–µ—Å–∫–∏–µ —Å–∫–∞–∑–∫–∏</h1>
            <p class="mb-0 fs-5">
                –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏—Å—Ç–æ—Ä–∏–∏ –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –¥–µ—Ç—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º –∏ –¥—É—Ö–æ–≤–Ω–æ–≥–æ —Ä–æ—Å—Ç–∞
            </p>
        </div>
    </div>

    <!-- –§–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–∏—Å–∫ -->
    <div class="search-filters">
        <form method="get" class="mb-0">
            <div class="filter-row">
                <input 
                    type="text" 
                    name="search" 
                    value="{{ current_filters.search }}" 
                    placeholder="–ü–æ–∏—Å–∫ —Å–∫–∞–∑–æ–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º–µ..."
                    class="search-input"
                >
                
                <select name="age_group" class="form-select" style="width: auto;">
                    <option value="">–í—Å–µ –≤–æ–∑—Ä–∞—Å—Ç—ã</option>
                    {% for value, label in age_groups %}
                        <option value="{{ value }}" {% if current_filters.age_group == value %}selected{% endif %}>
                            {{ label }}
                        </option>
                    {% endfor %}
                </select>
                
                <select name="goal" class="form-select" style="width: auto;">
                    <option value="">–í—Å–µ —Ü–µ–ª–∏</option>
                    {% for value, label in therapeutic_goals %}
                        <option value="{{ value }}" {% if current_filters.goal == value %}selected{% endif %}>
                            {{ label }}
                        </option>
                    {% endfor %}
                </select>
                
                <button type="submit" class="btn btn-primary">
                    <i class="bi bi-search"></i> –ù–∞–π—Ç–∏
                </button>
            </div>
        </form>

        <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
        <div class="mt-3">
            <div class="categories-container">
                <!-- –í—Å–µ–≥–¥–∞ –≤–∏–¥–∏–º—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
                <div class="category-row">
                    <a href="{% url 'fairy_tales:list' %}" 
                       class="category-filter-btn {% if not current_filters.category %}active{% endif %}">
                        <i class="bi bi-grid-3x3-gap"></i> –í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                    </a>
                    {% for category in categories|slice:":7" %}
                        <a href="?category={{ category.slug }}" 
                           class="category-filter-btn {% if current_filters.category == category.slug %}active{% endif %}">
                            <i class="bi bi-{{ category.icon }}"></i> {{ category.name }}
                        </a>
                    {% endfor %}
                </div>

                <!-- –°–∫—Ä—ã—Ç—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
                {% if categories|length > 7 %}
                    <div class="hidden-categories" id="hiddenCategories">
                        <div class="category-row">
                            {% for category in categories|slice:"7:" %}
                                <a href="?category={{ category.slug }}" 
                                   class="category-filter-btn {% if current_filters.category == category.slug %}active{% endif %}">
                                    <i class="bi bi-{{ category.icon }}"></i> {{ category.name }}
                                </a>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è -->
                    <div class="d-flex justify-content-center mt-2">
                        <button 
                            class="toggle-categories-btn" 
                            id="toggleCategoriesBtn"
                            onclick="toggleCategories()"
                            type="button"
                        >
                            <span class="toggle-text">–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</span>
                            <span class="categories-counter" id="hiddenCounter">+{{ categories|length|add:"-7" }}</span>
                            <i class="bi bi-chevron-down toggle-icon"></i>
                        </button>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    {% if total_tales %}
        <div class="row mb-4">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center">
                    <p class="mb-0 text-muted">
                        –ù–∞–π–¥–µ–Ω–æ {{ paginator.count|default:total_tales }} {{ paginator.count|default:total_tales|pluralize:"—Å–∫–∞–∑–∫–∞,—Å–∫–∞–∑–∫–∏,—Å–∫–∞–∑–æ–∫" }}
                    </p>
                    
                    <div class="d-flex align-items-center">
                        <label class="me-2 text-muted">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:</label>
                        <select class="form-select form-select-sm" onchange="updateSort(this.value)" style="width: auto;">
                            <option value="featured" {% if current_filters.sort == 'featured' %}selected{% endif %}>–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ</option>
                            <option value="newest" {% if current_filters.sort == 'newest' %}selected{% endif %}>–ù–æ–≤—ã–µ</option>
                            <option value="popular" {% if current_filters.sort == 'popular' %}selected{% endif %}>–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ</option>
                            <option value="age_asc" {% if current_filters.sort == 'age_asc' %}selected{% endif %}>–ü–æ –≤–æ–∑—Ä–∞—Å—Ç—É ‚Üë</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}

    <!-- –°–ø–∏—Å–æ–∫ —Å–∫–∞–∑–æ–∫ -->
    <div class="row">
        {% for fairy_tale in fairy_tales %}
            <div class="col-lg-4 col-md-6 mb-4">
                <div class="fairy-tale-card">
                    <div class="fairy-tale-image">
                        {% if fairy_tale.cover_image %}
                            <img src="{{ fairy_tale.cover_image.url }}" 
                                 alt="{{ fairy_tale.title }}"
                                 style="width: 100%; height: 100%; object-fit: cover;">
                        {% else %}
                            <i class="bi bi-book-heart"></i>
                        {% endif %}
                    </div>
                    
                    <div class="fairy-tale-content">
                        <h3 class="fairy-tale-title">
                            <a href="{% url 'fairy_tales:detail' slug=fairy_tale.slug %}" class="text-decoration-none">
                                {{ fairy_tale.title }}
                            </a>
                        </h3>
                        
                        <p class="fairy-tale-description">
                            {{ fairy_tale.short_description }}
                        </p>
                        
                        <div class="d-flex justify-content-between align-items-center flex-wrap">
                            <div>
                                <span class="age-badge">
                                    {{ fairy_tale.age_range_display }}
                                </span>
                                {% if fairy_tale.is_free %}
                                    <span class="price-badge free">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</span>
                                {% else %}
                                    <span class="price-badge">–æ—Ç {{ fairy_tale.base_price }} ‚ÇΩ</span>
                                {% endif %}
                            </div>
                            
                            <div class="text-muted small">
                                <i class="bi bi-eye"></i> {{ fairy_tale.views_count }}
                                {% if fairy_tale.orders_count %}
                                    <i class="bi bi-cart ms-2"></i> {{ fairy_tale.orders_count }}
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="mt-2">
                            <small class="text-muted">
                                <i class="bi bi-tag"></i> {{ fairy_tale.category.name }}
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        {% empty %}
            <div class="col-12">
                <div class="text-center py-5">
                    <i class="bi bi-search display-1 text-muted"></i>
                    <h3 class="mt-3 text-muted">–°–∫–∞–∑–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                    <p class="text-muted">
                        –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ –∏–ª–∏ 
                        <a href="{% url 'fairy_tales:list' %}">–ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ —Å–∫–∞–∑–∫–∏</a>
                    </p>
                </div>
            </div>
        {% endfor %}
    </div>

    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
    {% if is_paginated %}
        <div class="row">
            <div class="col-12">
                <nav aria-label="–ü–∞–≥–∏–Ω–∞—Ü–∏—è —Å–∫–∞–∑–æ–∫">
                    <ul class="pagination justify-content-center">
                        {% if page_obj.has_previous %}
                            <li class="page-item">
                                <a class="page-link" href="?page=1{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}{% if request.GET.age_group %}&age_group={{ request.GET.age_group }}{% endif %}{% if request.GET.goal %}&goal={{ request.GET.goal }}{% endif %}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}">
                                    <i class="bi bi-chevron-double-left"></i>
                                </a>
                            </li>
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}{% if request.GET.age_group %}&age_group={{ request.GET.age_group }}{% endif %}{% if request.GET.goal %}&goal={{ request.GET.goal }}{% endif %}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}">
                                    <i class="bi bi-chevron-left"></i>
                                </a>
                            </li>
                        {% endif %}

                        {% for num in page_obj.paginator.page_range %}
                            {% if page_obj.number == num %}
                                <li class="page-item active">
                                    <span class="page-link">{{ num }}</span>
                                </li>
                            {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                                <li class="page-item">
                                    <a class="page-link" href="?page={{ num }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}{% if request.GET.age_group %}&age_group={{ request.GET.age_group }}{% endif %}{% if request.GET.goal %}&goal={{ request.GET.goal }}{% endif %}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}">{{ num }}</a>
                                </li>
                            {% endif %}
                        {% endfor %}

                        {% if page_obj.has_next %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}{% if request.GET.age_group %}&age_group={{ request.GET.age_group }}{% endif %}{% if request.GET.goal %}&goal={{ request.GET.goal }}{% endif %}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}">
                                    <i class="bi bi-chevron-right"></i>
                                </a>
                            </li>
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}{% if request.GET.age_group %}&age_group={{ request.GET.age_group }}{% endif %}{% if request.GET.goal %}&goal={{ request.GET.goal }}{% endif %}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}">
                                    <i class="bi bi-chevron-double-right"></i>
                                </a>
                            </li>
                        {% endif %}
                    </ul>
                </nav>
            </div>
        </div>
    {% endif %}

    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –±–ª–æ–∫ -->
    <div class="row mt-5">
        <div class="col-12">
            <div class="alert alert-info">
                <h4 class="alert-heading mb-3">
                    <i class="bi bi-info-circle me-2"></i>
                    –ß—Ç–æ —Ç–∞–∫–æ–µ —Ç–µ—Ä–∞–ø–µ–≤—Ç–∏—á–µ—Å–∫–∏–µ —Å–∫–∞–∑–∫–∏?
                </h4>
                <p class="mb-0">
                    –¢–µ—Ä–∞–ø–µ–≤—Ç–∏—á–µ—Å–∫–∏–µ —Å–∫–∞–∑–∫–∏ - —ç—Ç–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –∏—Å—Ç–æ—Ä–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–º–æ–≥–∞—é—Ç –¥–µ—Ç—è–º –∏ –≤–∑—Ä–æ—Å–ª—ã–º 
                    —Å–ø—Ä–∞–≤–ª—è—Ç—å—Å—è —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º–∏ —Ç—Ä—É–¥–Ω–æ—Å—Ç—è–º–∏. –ö–∞–∂–¥–∞—è —Å–∫–∞–∑–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –ø–æ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ 
                    —á–µ–ª–æ–≤–µ–∫–∞ –∏ –µ–≥–æ –ø—Ä–æ–±–ª–µ–º—É, —á—Ç–æ –¥–µ–ª–∞–µ—Ç —Ç–µ—Ä–∞–ø–µ–≤—Ç–∏—á–µ—Å–∫–∏–π —ç—Ñ—Ñ–µ–∫—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –¥–µ–π—Å—Ç–≤–µ–Ω–Ω—ã–º.
                </p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function updateSort(value) {
    const url = new URL(window.location);
    url.searchParams.set('sort', value);
    window.location.href = url.toString();
}

// –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π
let isExpanded = false;

function toggleCategories() {
    const hiddenCategories = document.getElementById('hiddenCategories');
    const toggleBtn = document.getElementById('toggleCategoriesBtn');
    const toggleText = toggleBtn.querySelector('.toggle-text');
    const hiddenCounter = document.getElementById('hiddenCounter');
    
    if (!isExpanded) {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–∫—Ä—ã—Ç—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        hiddenCategories.classList.add('show');
        toggleBtn.classList.add('expanded');
        toggleText.textContent = '–°–∫—Ä—ã—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏';
        hiddenCounter.style.display = 'none';
        
        // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π
        setTimeout(() => {
            const categoryBtns = hiddenCategories.querySelectorAll('.category-filter-btn');
            categoryBtns.forEach((btn, index) => {
                setTimeout(() => {
                    btn.classList.add('fade-in-up');
                }, index * 50);
            });
        }, 100);
        
        isExpanded = true;
    } else {
        // –°–∫—Ä—ã–≤–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        hiddenCategories.classList.remove('show');
        toggleBtn.classList.remove('expanded');
        toggleText.textContent = '–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏';
        hiddenCounter.style.display = 'inline-block';
        
        // –£–±–∏—Ä–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
        const categoryBtns = hiddenCategories.querySelectorAll('.category-filter-btn');
        categoryBtns.forEach(btn => {
            btn.classList.remove('fade-in-up');
        });
        
        isExpanded = false;
    }
}

document.addEventListener('DOMContentLoaded', function() {
    // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };
    
    const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry, index) => {
            if (entry.isIntersecting) {
                setTimeout(() => {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }, index * 100);
                observer.unobserve(entry.target);
            }
        });
    }, observerOptions);
    
    // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ –∫ –∞–Ω–∏–º–∞—Ü–∏–∏
    document.querySelectorAll('.fairy-tale-card').forEach(card => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(30px)';
        card.style.transition = 'all 0.6s ease-out';
        observer.observe(card);
    });
});
</script>
{% endblock %}
