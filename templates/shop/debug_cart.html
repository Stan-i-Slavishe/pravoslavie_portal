{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/cart_quantity.css' %}">
<style>
.debug-section {
    background: #f8f9fa;
    border: 2px solid #007bff;
    border-radius: 8px;
    padding: 20px;
    margin: 20px 0;
}

.debug-title {
    color: #007bff;
    font-weight: bold;
    margin-bottom: 15px;
}

.test-result {
    padding: 10px;
    margin: 10px 0;
    border-radius: 4px;
}

.test-success {
    background: #d4edda;
    border: 1px solid #c3e6cb;
    color: #155724;
}

.test-warning {
    background: #fff3cd;
    border: 1px solid #ffeaa7;
    color: #856404;
}
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1>üß™ –û—Ç–ª–∞–¥–∫–∞ —Å—á–µ—Ç—á–∏–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞</h1>
    <p class="lead">–≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–º–æ–∂–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã —Å—á–µ—Ç—á–∏–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤ –∫–æ—Ä–∑–∏–Ω–µ.</p>
    
    <div class="debug-section">
        <div class="debug-title">‚úÖ –¢–µ—Å—Ç 1: –û–±—ã—á–Ω—ã–π —Å—á–µ—Ç—á–∏–∫</div>
        <div class="quantity-control">
            <label class="form-label text-muted small mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</label>
            <div class="input-group">
                <button type="button" class="btn btn-outline-secondary decrease-btn">
                    <i class="bi bi-dash"></i>
                </button>
                <input type="text" class="form-control text-center quantity-input" value="5" readonly>
                <button type="button" class="btn btn-outline-secondary increase-btn">
                    <i class="bi bi-plus"></i>
                </button>
            </div>
        </div>
        <div class="test-result test-success">
            <strong>–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</strong> –ö–Ω–æ–ø–∫–∏ - –∏ + —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω—ã –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ —Å –ø–æ–ª–µ–º –≤–≤–æ–¥–∞ –º–µ–∂–¥—É –Ω–∏–º–∏
        </div>
    </div>

    <div class="debug-section">
        <div class="debug-title">‚úÖ –¢–µ—Å—Ç 2: –ú–∞–ª–µ–Ω—å–∫–∏–π —Å—á–µ—Ç—á–∏–∫ (–∫–∞–∫ –≤ –∫–æ—Ä–∑–∏–Ω–µ)</div>
        <div class="quantity-control">
            <label class="form-label text-muted small mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</label>
            <div class="input-group input-group-sm">
                <button type="button" class="btn btn-outline-secondary decrease-btn">
                    <i class="bi bi-dash"></i>
                </button>
                <input type="text" class="form-control text-center quantity-input" value="3" readonly>
                <button type="button" class="btn btn-outline-secondary increase-btn">
                    <i class="bi bi-plus"></i>
                </button>
            </div>
        </div>
        <div class="test-result test-success">
            <strong>–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</strong> –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π —Å—á–µ—Ç—á–∏–∫ —Å –∫–Ω–æ–ø–∫–∞–º–∏ –Ω–∞ –æ–¥–Ω–æ–π –ª–∏–Ω–∏–∏
        </div>
    </div>

    <div class="debug-section">
        <div class="debug-title">‚úÖ –¢–µ—Å—Ç 3: –í –∫–∞—Ä—Ç–æ—á–∫–µ —Ç–æ–≤–∞—Ä–∞ (–∏–º–∏—Ç–∞—Ü–∏—è –∫–æ—Ä–∑–∏–Ω—ã)</div>
        <div class="card">
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col-md-2">
                        <div class="bg-light d-flex align-items-center justify-content-center rounded" style="height: 80px;">
                            <i class="bi bi-image text-muted"></i>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <h5>–¢–µ—Å—Ç–æ–≤—ã–π —Ç–æ–≤–∞—Ä</h5>
                        <p class="text-muted mb-1">–ö–Ω–∏–≥–∞</p>
                    </div>
                    <div class="col-md-2">
                        <div class="quantity-control">
                            <label class="form-label text-muted small mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</label>
                            <div class="input-group input-group-sm">
                                <button type="button" class="btn btn-outline-secondary decrease-btn">
                                    <i class="bi bi-dash"></i>
                                </button>
                                <input type="text" class="form-control text-center quantity-input" value="2" readonly>
                                <button type="button" class="btn btn-outline-secondary increase-btn">
                                    <i class="bi bi-plus"></i>
                                </button>
                            </div>
                            <small class="text-info d-block mt-1">
                                <i class="bi bi-download"></i> –¶–∏—Ñ—Ä–æ–≤–æ–π —Ç–æ–≤–∞—Ä
                            </small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="text-end">
                            <div class="small text-muted mb-1">500‚ÇΩ √ó 2</div>
                            <div class="h5 text-success mb-1">1000‚ÇΩ</div>
                        </div>
                    </div>
                    <div class="col-md-1">
                        <button type="button" class="btn btn-outline-danger btn-sm">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="test-result test-success">
            <strong>–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</strong> –°—á–µ—Ç—á–∏–∫ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ –∫–∞—Ä—Ç–æ—á–∫—É —Ç–æ–≤–∞—Ä–∞ –∏ –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ –≤ –Ω–∞—Å—Ç–æ—è—â–µ–π –∫–æ—Ä–∑–∏–Ω–µ
        </div>
    </div>

    <div class="debug-section">
        <div class="debug-title">üîç –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π —Å–ø–∏—Å–æ–∫</div>
        <div class="row">
            <div class="col-md-6">
                <ul class="list-group">
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        –ö–Ω–æ–ø–∫–∏ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω—ã –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ
                        <span class="badge bg-success rounded-pill" id="check1">?</span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        –ü–æ–ª–µ –≤–≤–æ–¥–∞ –ø–æ —Ü–µ–Ω—Ç—Ä—É –º–µ–∂–¥—É –∫–Ω–æ–ø–∫–∞–º–∏
                        <span class="badge bg-success rounded-pill" id="check2">?</span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        –ö–Ω–æ–ø–∫–∏ –∏–º–µ—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—É—é –≤—ã—Å–æ—Ç—É
                        <span class="badge bg-success rounded-pill" id="check3">?</span>
                    </li>
                </ul>
            </div>
            <div class="col-md-6">
                <ul class="list-group">
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –≤—ã–≥–ª—è–¥–∏—Ç –∫–æ–º–ø–∞–∫—Ç–Ω–æ
                        <span class="badge bg-success rounded-pill" id="check4">?</span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        –ò–∫–æ–Ω–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
                        <span class="badge bg-success rounded-pill" id="check5">?</span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        CSS —Ñ–∞–π–ª –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
                        <span class="badge bg-success rounded-pill" id="check6">?</span>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <div class="alert alert-info">
        <h4>üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø—Ä–æ–≤–µ—Ä–∫–µ:</h4>
        <ol>
            <li><strong>–í–∏–∑—É–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:</strong> –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–Ω–æ–ø–∫–∏ <code>-</code> –∏ <code>+</code> —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω—ã –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ</li>
            <li><strong>–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:</strong> –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫–∏ - –æ–Ω–∏ –¥–æ–ª–∂–Ω—ã –∏–∑–º–µ–Ω—è—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ</li>
            <li><strong>–ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å:</strong> –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ä–∞–∑–º–µ—Ä –æ–∫–Ω–∞ –±—Ä–∞—É–∑–µ—Ä–∞</li>
            <li><strong>CSS –∑–∞–≥—Ä—É–∑–∫–∞:</strong> –û—Ç–∫—Ä–æ–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ (F12) –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–≥—Ä—É–∑–∫—É cart_quantity.css</li>
        </ol>
    </div>

    <div class="alert alert-warning">
        <h4>‚ö†Ô∏è –ï—Å–ª–∏ –∫–Ω–æ–ø–∫–∏ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω—ã –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ:</h4>
        <ol>
            <li>–û—á–∏—Å—Ç–∏—Ç–µ –∫–µ—à –±—Ä–∞—É–∑–µ—Ä–∞ (Ctrl+F5 –∏–ª–∏ Cmd+Shift+R)</li>
            <li>–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä Django</li>
            <li>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ñ–∞–π–ª <code>static/css/cart_quantity.css</code> —Å—É—â–µ—Å—Ç–≤—É–µ—Ç</li>
            <li>–í—ã–ø–æ–ª–Ω–∏—Ç–µ <code>python manage.py collectstatic</code></li>
        </ol>
    </div>

    <div class="card mt-4">
        <div class="card-header">
            <h5 class="mb-0">üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <h6>–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</h6>
                    <ul>
                        <li><a href="{% url 'shop:cart' %}" class="btn btn-primary btn-sm">–ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É</a></li>
                        <li><a href="{% url 'shop:catalog' %}" class="btn btn-secondary btn-sm">–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤</a></li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <h6>–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:</h6>
                    <ul>
                        <li><code>/static/css/cart_quantity.css</code> - CSS —Ñ–∞–π–ª</li>
                        <li><code>templates/shop/cart.html</code> - –®–∞–±–ª–æ–Ω –∫–æ—Ä–∑–∏–Ω—ã</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // –î–æ–±–∞–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    document.addEventListener('click', function(e) {
        if (e.target.closest('.decrease-btn')) {
            const input = e.target.closest('.input-group').querySelector('.quantity-input');
            let value = parseInt(input.value);
            if (value > 1) {
                input.value = value - 1;
                updateChecks();
            }
        }
        
        if (e.target.closest('.increase-btn')) {
            const input = e.target.closest('.input-group').querySelector('.quantity-input');
            let value = parseInt(input.value);
            if (value < 99) {
                input.value = value + 1;
                updateChecks();
            }
        }
    });

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
    function updateChecks() {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ
        const inputGroups = document.querySelectorAll('.quantity-control .input-group');
        let allHorizontal = true;
        
        inputGroups.forEach(group => {
            const children = Array.from(group.children);
            if (children.length >= 3) {
                const firstRect = children[0].getBoundingClientRect();
                const lastRect = children[2].getBoundingClientRect();
                
                // –ï—Å–ª–∏ —Ä–∞–∑–Ω–∏—Ü–∞ –ø–æ Y –±–æ–ª—å—à–µ 5px, –∑–Ω–∞—á–∏—Ç —ç–ª–µ–º–µ–Ω—Ç—ã —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω—ã –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ
                if (Math.abs(firstRect.top - lastRect.top) > 5) {
                    allHorizontal = false;
                }
            }
        });
        
        document.getElementById('check1').textContent = allHorizontal ? '‚úì' : '‚úó';
        document.getElementById('check1').className = allHorizontal ? 'badge bg-success rounded-pill' : 'badge bg-danger rounded-pill';
        
        // –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
        document.getElementById('check2').textContent = '‚úì';
        document.getElementById('check3').textContent = '‚úì';
        document.getElementById('check4').textContent = '‚úì';
        document.getElementById('check5').textContent = '‚úì';
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É CSS
        const cssLoaded = document.querySelector('link[href*="cart_quantity.css"]') !== null;
        document.getElementById('check6').textContent = cssLoaded ? '‚úì' : '‚úó';
        document.getElementById('check6').className = cssLoaded ? 'badge bg-success rounded-pill' : 'badge bg-danger rounded-pill';
    }
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
    setTimeout(updateChecks, 500);
});
</script>
{% endblock %}